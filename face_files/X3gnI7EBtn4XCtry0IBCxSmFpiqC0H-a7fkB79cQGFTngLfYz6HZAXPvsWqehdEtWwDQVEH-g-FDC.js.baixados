;/*FB_PKG_DELIM*/

__d("WAWebDBRevokeInviteV4",["WAWebApiGroupInviteV4Store","WAWebBackendApi","WAWebDBMsgUtils","WAWebDBProcessMessage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield d("WAWebApiGroupInviteV4Store").revokeGroupInvites(a,b,c,e));b=(a==null?void 0:a.map(function(a){return a.id}))||[];c=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(b,function(a){a.inviteCodeExp="0"}));for(e of c)d("WAWebBackendApi").frontendFireAndForget("expireGroupInviteV4",{inviteMsgId:e.id}),d("WAWebDBProcessMessage").updateExistingMessages([e],e.id.remote)});return h.apply(this,arguments)}g.revokeGroupInviteV4=a}),98);
__d("WAWebOnlineDanglingReceipts",["Promise","WALogger","WATimeUtils","WAWebABProps","WAWebCommsSendPing","WAWebNetworkStatus","WAWebSchemaDanglingReceipt","WAWebSendReceiptJobCommon","WAWebWamOfflineResumeReporter","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOrFlushOnlineDanglingReceipts: flush "," receipts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOrFlushOnlineDanglingReceipts: flush due to offline."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOrFlushOnlineDanglingReceipts: failed to send ping"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOrFlushOnlineDanglingReceipts: starting clean receipts"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOrFlushOnlineDanglingReceipts: starting sending ping"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: skip due to empty receipts."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: start to clean online dangling receipts due to timeout"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOnlineDanglingReceipts: starting clean receipts"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOnlineDanglingReceipts: starting sending ping"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOnlineDanglingReceipts: skip due to empty receipts."]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: clearOnlineDanglingReceipts: skip due to offline."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[online-preacks]: sending online dangling grouped receipts: ",""]);t=function(){return a};return a}var u=new Map(),v=null,w=120*1e3;function a(a,b,c){u.has(a)||u.set(a,new Map());a=u.get(a);(a==null?void 0:a.has(b))||(a==null?void 0:a.set(b,[]));a==null?void 0:(a=a.get(b))==null?void 0:a.push(c);v||(v=self.setTimeout(function(){void B(),v=null},w))}function x(){return u.size>0&&d("WAWebABProps").getABPropConfigValue("web_pre_acks_m3_receipts_enabled")}function e(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=String(d("WATimeUtils").unixTime()),c=0,e=Array.from(u.keys()).map(function(b){var e=u.get(b);if(!e)return;e.forEach(function(a){c+=a.length});d("WALogger").LOG(t(),e.size);return d("WAWebSendReceiptJobCommon").sendAggregateReceipts({to:b,type:d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.DELIVERY,t:a,groupedReceipt:e})});yield (h||(h=b("Promise"))).all(e);d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreackCount(c,!0);void z()});return y.apply(this,arguments)}function z(){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!c("WAWebNetworkStatus").online){d("WALogger").LOG(s());return(h||(h=b("Promise"))).resolve()}if(u.size===0){d("WALogger").LOG(r());return(h||(h=b("Promise"))).resolve()}d("WALogger").LOG(q());yield d("WAWebCommsSendPing").blockSendPing();d("WALogger").LOG(p());u.clear()});return A.apply(this,arguments)}function B(){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(o());if(u.size===0){d("WALogger").LOG(n());return(h||(h=b("Promise"))).resolve()}if(!c("WAWebNetworkStatus").online)return D();d("WALogger").LOG(m());try{yield d("WAWebCommsSendPing").blockSendPing(),d("WALogger").LOG(l()),u.clear()}catch(a){d("WALogger").LOG(k()),void D()}});return C.apply(this,arguments)}function D(){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!x()||!d("WAWebABProps").getABPropConfigValue("web_pre_acks_m3_enabled"))return;d("WALogger").LOG(j());var a=[];u.forEach(function(b,c){b.forEach(function(b,d){b.forEach(function(b){a.push({from:String(c),author:String(d),externalId:b})})})});a.length>0&&(d("WALogger").LOG(i(),a.length),yield d("WAWebSchemaDanglingReceipt").getTable().create({receipts:a,acks:[]}),u.clear())});return E.apply(this,arguments)}g.addOnlineDanglingReceipts=a;g.hasOnlineDanglingReceipts=x;g.sendAndClearOnlineDanglingReceipts=e}),98);
__d("WAWebGroupParticipantsJob",["WAJobOrchestratorTypes","WAWebGroupsParticipantsApi","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateParticipants",function(a){return d("WAWebGroupsParticipantsApi").updateParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}function b(a,b,c,e){a={group:a,participants:b,isOffline:c,reason:e};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("addParticipants",function(a){return d("WAWebGroupsParticipantsApi").addParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}function c(a,b,c,e,f,g,h){a={group:a,participants:b,timestamp:c,author:e,reason:f,groupMetadata:g,isOffline:h};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("removeParticipants",function(a){return d("WAWebGroupsParticipantsApi").removeParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}function e(a,b,c,e){a={group:a,participants:b,groupMetadata:c,isOffline:e};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("demoteParticipants",function(a){return d("WAWebGroupsParticipantsApi").demoteParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}function f(a,b,c,e){a={group:a,participants:b,groupMetadata:c,isOffline:e};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("promoteParticipants",function(a){return d("WAWebGroupsParticipantsApi").promoteParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}function h(a,b,c){a={group:a,participants:b,isOffline:c};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("promoteCommunityParticipants",function(a){return d("WAWebGroupsParticipantsApi").promoteCommmunityParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}function i(a,b,c){a={group:a,participants:b,isOffline:c};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("demoteCommunityParticipants",function(a){return d("WAWebGroupsParticipantsApi").demoteCommmunityParticipants(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}g.updateParticipantsJob=a;g.addParticipantsJob=b;g.removeParticipantsJob=c;g.demoteParticipantsJob=e;g.promoteParticipantsJob=f;g.promoteCommunityParticipantsJob=h;g.demoteCommunityParticipantsJob=i}),98);
__d("WAWebApiUnjoinedSubgroupMetadataStore",["WAWebSchemaUnjoinedSubgroupMetadata","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().remove(a.toString())}function h(a){var b={},c=a.defaultSubgroup,d=a.generalSubgroup,e=a.parentGroupId,f=babelHelpers.objectWithoutPropertiesLoose(a,["defaultSubgroup","generalSubgroup","parentGroupId"]);c!=null&&(b.defaultSubgroup=c);d!=null&&(b.generalSubgroup=d);e!=null&&(b.parentGroup=e.toString());return babelHelpers["extends"]({},f,b,{id:a.id.toString()})}function c(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.unjoinedSubgroups,c=a.parentGroupId;a=a.link;if(!a){yield d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkRemove(b.map(function(a){return a.id.toString()}));return}a=[];var e=(yield d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkGet(b.map(function(a){return a.id.toString()})));a=b.map(function(a,b){b=e[b];var d={subject:a.subject,subjectTime:a.subjectTime||0};if(b){var f=b.subjectTime||0;f>d.subjectTime&&(d={subject:b.subject,subjectTime:f})}return h(babelHelpers["extends"]({},a,d,{parentGroupId:c}))});yield d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkCreateOrMerge(a)});return i.apply(this,arguments)}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.unjoinedSubgroupIds;a=a.parentGroupId;a=(yield d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().equals(["parentGroup"],a.toString()));a=a.map(function(a){return a.id});var c=b.map(function(a){return a.toString()});b=a.filter(function(a){return!c.includes(a)});yield d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkRemoveByIndex(["id"],b)});return j.apply(this,arguments)}g.removeUnjoinedSubgroupMetadataFromStorage=a;g.updateUnjoinedSubgroups=c;g.cleanUnjoinedSubgroups=e}),98);
__d("WAWebGroupUnjoinedSubgroupJob",["WAJobOrchestratorTypes","WAWebApiUnjoinedSubgroupMetadataStore","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a,b,c){c===void 0&&(c=!0);return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateUnjoinedSubgroups",function(a){return d("WAWebApiUnjoinedSubgroupMetadataStore").updateUnjoinedSubgroups(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted({unjoinedSubgroups:a,parentGroupId:b,link:c})}function b(a,b){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("cleanUnjoinedSubgroups",function(a){return d("WAWebApiUnjoinedSubgroupMetadataStore").cleanUnjoinedSubgroups(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted({unjoinedSubgroupIds:a,parentGroupId:b})}g.updateUnjoinedSubgroupsJob=a;g.cleanUnjoinedSubgroupsJob=b}),98);
__d("WAWebFetchPrekeysJob",["WALogger","WAParsableXmlNode","WASmaxPreKeysFetchKeyBundlesRPC","WAWebBackendErrors","WAWebProcessKeyBundle","WAWebWidFactory","WAWebWidToJid","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchPrekeys: successfully established "," E2E sessions out of "," requested"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=!1);var e=(yield d("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:a.map(function(a){return{userJid:d("WAWebWidToJid").widToDeviceJid(a),hasUserReasonIdentity:b}})}));if(e.name==="FetchKeyBundlesResponseServerError"){var f=e.value.errorServerErrors.value;throw new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(f.code),"fetchPrekeys: server error: "+f.code+" "+f.text)}else if(e.name==="FetchKeyBundlesResponseRequestError"){f=e.value.errorRequestErrorsFetch.value;throw new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(f.code),"fetchPrekeys: request error: "+f.code+" "+f.text)}f=e.value.listUser.map(function(a){var b=a.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;switch(b.name){case"FetchKeyBundlesUserSuccess":var e=b.value,f=e.preKeyMixin,g=e.elementValue,h=e.deviceIdentityMixin,i=e.skeyIdKeyIDMixin,j=e.skeyValueKeyDataMixin,k=e.skeySignatureElementValue;e=e.registrationElementValue;return{deviceIdentity:(h=h==null?void 0:h.deviceIdentityElementValue)!=null?h:null,identity:g,skey:{id:d("WAParsableXmlNode").convertBytesToUint(i.elementValue,3),pubkey:j.elementValue,signature:k},key:f?{id:d("WAParsableXmlNode").convertBytesToUint(f.keyIdKeyIDMixin.elementValue,3),pubkey:(h=f.keyValueKeyDataMixin)==null?void 0:h.elementValue}:null,regId:d("WAParsableXmlNode").convertBytesToUint(e,4),wid:d("WAWebWidFactory").createWid(a.jid)};case"FetchKeyBundlesUserErrorFallback":case"FetchKeyBundlesUserError":g=b.value;i=g.errorCode;j=g.errorText;return c("err")("fetchPrekeys: list item error: "+i+" "+j)}});if(f.length===0)throw c("err")("fetchPrekeys: empty key info");e=(yield d("WAWebProcessKeyBundle").processKeyBundles(f));f=e.depletedPrekeyCount;e=e.processedPrekeyCount;d("WALogger").LOG(h(),e,a.length);return{depletedPrekeyCount:f}});return i.apply(this,arguments)}g.fetchPrekeys=a}),98);
__d("WAWebManageE2ESessionsJob",["Promise","WALogger","WAResolvable","WAShiftTimer","WAWebEventsWaitForOfflineDeliveryEnd","WAWebFetchPrekeysJob","WAWebSignal","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ensureE2ESessions: "," wids: "," existing sessions, "," requested, "," requests deduplicated"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["ensureE2ESessions: "," wids: deduped requests failed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ensureE2ESessions: "," wids: request failed: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["ensureE2ESessions: can only estabilish session with user wid"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["ensureE2ESessions: "," wids: ",""]);m=function(){return a};return a}var n=new Map(),o=new Map();function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c===void 0&&(c=!1);yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();d("WALogger").LOG(m(),a.length,a.map(function(a){return a.toString()}).join());var e=new(d("WAResolvable").Resolvable)(),f=[],g=[];a.forEach(function(a){if(!a.isUserNotPSA()){d("WALogger").LOG(l());return}var b=n.get(a.toString());b&&(b.cancel(),n["delete"](a.toString()));b=o.get(a.toString());b?f.push(b):(g.push(a),o.set(a.toString(),e.promise))});var p=0,q=0;try{if(g.length>0){var r=(yield d("WAWebSignal").Session.hasSignalSessions(g)),s=g.filter(function(a,b){return!r[b]});if(s.length>0){c=(yield d("WAWebFetchPrekeysJob").fetchPrekeys(s,c));q=(c=c.depletedPrekeyCount)!=null?c:0;p=s.length}}e.resolve()}catch(b){d("WALogger").WARN(k(),a.length,b);e.resolve(b);throw b}finally{g.forEach(function(a){return o["delete"](a.toString())})}try{c=(yield (h||(h=b("Promise"))).all(f)).find(Boolean);if(c)throw c}catch(b){d("WALogger").WARN(j(),a.length,b);throw b}d("WALogger").LOG(i(),a.length,g.length-p,p,f.length);return{missedPrekeyCount:p,depletedPrekeyCount:q}});return q.apply(this,arguments)}function a(a,b,c){c===void 0&&(c=!1);var e=new(d("WAShiftTimer").ShiftTimer)(function(){p(a,c)});a.forEach(function(a){n.set(String(a),e)});e.onOrAfter(1e3*b)}g.ensureE2ESessions=p;g.ensureE2ESessionsWithDelay=a}),98);
__d("WAWebSendDeliveryReceiptJob",["Promise","WADeprecatedSendIq","WAJids","WAWap","WAWebCommsWapMd","WAWebMessagingGatingUtils","WAWebOnlineDanglingReceipts","WAWebSchemaInactiveReceipt","WAWebSendReceiptJobCommon","WAWebUserPrefsMeUser","WAWebWidFactory","WAWebWidToJid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(){return d("WAWebSchemaInactiveReceipt").getInactiveReceiptTable().all().then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=new Map(),e=Date.now().toString();a.forEach(function(a){var b=a.msgId,e=a.chatId;a=a.participantId;e=d("WAWebWidFactory").createWid(e);a=a?d("WAWebWidFactory").createWid(a):null;a=a||e;var f=c.get(e);f||(f=new Map(),c.set(e,f));e=f.get(a);e||(e=[],f.set(a,e));e.push(b)});yield (h||(h=b("Promise"))).all(Array.from(c.keys()).map(function(a){var b=c.get(a);if(!b)return;return d("WAWebSendReceiptJobCommon").sendAggregateReceipts({to:a,type:d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.DELIVERY,t:e,groupedReceipt:b})}));return d("WAWebSchemaInactiveReceipt").getInactiveReceiptTable().bulkRemove(a.map(function(a){return a.msgId}))});return function(b){return a.apply(this,arguments)}}())}function c(a,b,c,d,e,f){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,i){g===void 0&&(g=!1);var k=d("WAWebUserPrefsMeUser").assertGetMe(),l=c.isUser()&&d("WAWebWidFactory").toUserWid(k).equals(d("WAWebWidFactory").toUserWid(c))||f!=null&&d("WAWebWidFactory").toUserWid(k).equals(d("WAWebWidFactory").toUserWid(f));k=i.hasInactiveMsg===!0&&!l;var m=!k;i=(h||(h=b("Promise"))).resolve();if(!m&&!d("WAWebMessagingGatingUtils").isInactiveReceiptsV2Enabled()){k={msgId:a,chatId:c.toString(),participantId:f?f.toString():null};i=d("WAWebSchemaInactiveReceipt").getInactiveReceiptTable().createOrReplace(k)}return i.then(function(){void j(a,c,e,f,m,l,g);if(m)return d("WAWebSchemaInactiveReceipt").getInactiveReceiptTable().remove(a)})});return i.apply(this,arguments)}function j(a,b,c,d,e,f,g){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=d("WAWap").DROP_ATTR;h?i=d("WAWap").CUSTOM_STRING(d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.PEER_MSG):g?i=d("WAWap").CUSTOM_STRING(d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.SENDER):f||(i=d("WAWap").CUSTOM_STRING(d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.INACTIVE));f=(yield d("WAWebSendReceiptJobCommon").shouldRequestTcToken(b,i,d("WAWap").DROP_ATTR));var j=d("WAJids").extractJidFromJidWithType(d("WAWebWidToJid").widToJidWithType(b));j=d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(a),to:d("WAWap").JID(j),participant:(b.isGroup()||b.isBroadcast())&&e?d("WAWebCommsWapMd").DEVICE_JID(e):d("WAWap").DROP_ATTR,recipient:!h&&g&&c?d("WAWebCommsWapMd").USER_JID(c):d("WAWap").DROP_ATTR,type:i,privacy_token:f?d("WAWap").CUSTOM_STRING("false"):d("WAWap").DROP_ATTR});d("WAWebOnlineDanglingReceipts").addOnlineDanglingReceipts(b,e||b,a);d("WADeprecatedSendIq").deprecatedCastStanza(j)});return k.apply(this,arguments)}g.sendDeliveryReceiptsAfterPresence=a;g.sendDeliveryReceiptsAfterDecryption=c}),98);
__d("WAWebModelStorage",["WAWebModelStorageInitialize","WAWebUserPrefsIndexedDBStorage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebModelStorageInitialize").initializeWithoutGKs(a),yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.init()});return h.apply(this,arguments)}Object.keys(d("WAWebModelStorageInitialize")).forEach(function(a){if(a==="default"||a==="__esModule")return;g[a]=d("WAWebModelStorageInitialize")[a]});g.initialize=a}),98);
__d("WAWebABPropsGlobals",["WAWebWamGlobals"],(function(a,b,c,d,e,f,g){c=new Set();var h=new Set();function a(){d("WAWebWamGlobals").Global.set({expoKey:Array.from(h).join(",")})}function b(a){d("WAWebWamGlobals").Global.set({abKey2:a})}g.accessedConfigs=c;g.exposureKeys=h;g.updateGlobalExpoKey=a;g.updateGlobalABKey=b}),98);
__d("WAWebApiAbPropConfig",["Promise","WALogger","WAWebABPropsConfigs","WAWebABPropsGlobals","WAWebModelStorageInitialize","WAWebModelStorageUtils","WAWebSchemaAbPropConfig","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid ABProps config name"]);i=function(){return a};return a}function a(){return d("WAWebModelStorageInitialize").initializeWithoutGKs().then(function(){return d("WAWebSchemaAbPropConfig").getAbpropConfigsTable().all().then(function(a){return a})})}function j(a,b,c){if(a==null||b==null)return c;else if(b==="bool")return a==="1"||a==="True"||a==="true";else if(b==="int")return parseInt(a,10);else if(b==="float")return parseFloat(a);return a}function e(a){var e=d("WAWebABPropsConfigs").ABPropConfigs[a];if(e==null){d("WALogger").ERROR(i()).verbose().sendLogs("invalid ABProps config name: "+a);return(h||(h=b("Promise"))).reject(c("err")("invalid ABProps config name"))}var f=e[0],g=e[1];a=e[2];e=e[3];var k=a;return d("WAWebModelStorageInitialize").initializeWithoutGKs().then(function(){return d("WAWebSchemaAbPropConfig").getAbpropConfigsTable().get(String(f)).then(function(a){a=a?j(a.configValue,g,k):k;return a})})}function f(a){return d("WAWebModelStorageUtils").getStorage().lock(["abpropConfigs"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.all()),e=new Map();c.forEach(function(a){(a.configExpoKey!=null||a.overriddenConfigValue!=null)&&e.set(a.configCode,{configCode:a.configCode,configValue:a.configValue,configExpoKey:a.configExpoKey,hasAccessed:a.hasAccessed,overriddenConfigValue:a.overriddenConfigValue})});c=!1;var f=[];a.forEach(function(a,b){var g=!1,h=e.get(String(b));if(h){var i=h.configExpoKey;i!=null&&a.configExpoKey!==i?(d("WAWebABPropsGlobals").exposureKeys["delete"](i),c=!0,d("WAWebABPropsGlobals").accessedConfigs["delete"](b)):i!=null&&(g=h.hasAccessed)}f.push({configCode:String(b),configValue:a.configValue,configExpoKey:a.configExpoKey,hasAccessed:g,overriddenConfigValue:h==null?void 0:h.overriddenConfigValue})});c&&d("WAWebABPropsGlobals").updateGlobalExpoKey();yield b.clear();yield b.bulkCreate(f)});return function(a){return c.apply(this,arguments)}}())}function k(a){return d("WAWebModelStorageUtils").getStorage().lock(["abpropConfigs"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.get(String(a)));if(c==null||(c==null?void 0:c.hasAccessed)===!0)return;yield b.merge(String(a),{hasAccessed:!0})});return function(a){return c.apply(this,arguments)}}())}g.getABPropConfigs=a;g.parseConfigValue=j;g.getConfigValue=e;g.updateABPropConfigs=f;g.setConfigAccessed=k}),98);
__d("WAWebApiPeerMessageStore",["WAWebMsgKey","WAWebSchemaPeerMessage","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a){a=a.map(function(a){return babelHelpers["extends"]({},a,{id:String(a.id),to:String(a.to),subtype:String(a.subtype)})});d("WAWebSchemaPeerMessage").getPeerMessageTable().bulkCreate(a)}function b(a){var b=d("WAWebSchemaPeerMessage").getPeerMessageTable();a=new(c("WAWebMsgKey"))({fromMe:!0,remote:d("WAWebUserPrefsMeUser").getMeUser(),id:a});return b.remove(a.toString())}g.storePeerMessages=a;g.deletePeerMessage=b}),98);
__d("WAWebSchemaReadReceipt",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addUserDefinedPrimaryKey;function a(){d("WAWebOffdStorageUtils").getStorage().add("read-receipt").version(d("WAWebOffdStorageUtils").getStorage().versions.version(0),[i("id"),h("externalIds")])["delete"](d("WAWebOffdStorageUtils").getStorage().versions.version(3)).view(function(a){return a})}function b(){return d("WAWebOffdStorageUtils").getStorage().table("read-receipt")}g.addTable=a;g.getTable=b}),98);
__d("WAWebOffdStorage",["WALogger","WAWeb-dexie","WAWebDbRolloutUtil","WAWebDexieCastTypes","WAWebOffdStorageUtils","WAWebSchemaDanglingReceipt","WAWebSchemaPeerReadReceipt","WAWebSchemaPendingDeviceSync","WAWebSchemaReadReceipt","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);h=function(){return a};return a}f=4;var i;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){i==null&&(yield d("WAWebDbRolloutUtil").loadSchemaVersions(),d("WAWebOffdStorageUtils").createStorage(),d("WAWebSchemaReadReceipt").addTable(),d("WAWebSchemaDanglingReceipt").addTable(),d("WAWebSchemaPeerReadReceipt").addTable(),d("WAWebSchemaPendingDeviceSync").addTable(),i=d("WAWebOffdStorageUtils").getStorage().initialize()["catch"](function(a){d("WALogger").ERROR(h()).verbose().devConsole(a).tags("sad").sendLogs("Failed to initialize offd storage");throw a}));return i});return j.apply(this,arguments)}function e(){return d("WAWebOffdStorageUtils").destroyStorage()["catch"](function(){return d("WAWebDexieCastTypes").dexieCastToPromise(new(c("WAWeb-dexie"))(d("WAWebOffdStorageUtils").DATABASE_NAME)["delete"]())})["finally"](function(){i=null})}g.versionToRollout=f;g.initialize=a;g.destroy=e}),98);
__d("WAWebDexieBootstrap",["WAWeb-dexie"],(function(a,b,c,d,e,f,g){"use strict";function a(){c("WAWeb-dexie").Promise.PSD.onunhandled=function(){},c("WAWeb-dexie").Promise.PSD.txRelaxedDurabilityEnabled=!0}g.patchDexie=a}),98);
__d("WAWebSchemaLocalStorage",["WAWebStorageMutationBuilder","WAWebWorkerStorageUtils","WAWebWorkerStorageVersions"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addUserDefinedPrimaryKey;function a(){d("WAWebWorkerStorageUtils").getStorage().add("local_storage").version(d("WAWebWorkerStorageVersions").localStorageCreateTable(),[i("key"),h("value")]).view(function(a){return{key:a.key,value:a.value}})}function b(){return d("WAWebWorkerStorageUtils").getStorage().table("local_storage")}g.addTable=a;g.getTable=b}),98);
__d("WAWebWorkerStorage",["WALogger","WAWeb-dexie","WAWebDbRolloutUtil","WAWebDexieBootstrap","WAWebDexieCastTypes","WAWebSchemaDeferredMessagesStorage","WAWebSchemaLocalStorage","WAWebWorkerStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);h=function(){return a};return a}var i;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WAWebDexieBootstrap").patchDexie();i==null&&(yield d("WAWebDbRolloutUtil").loadSchemaVersions(),d("WAWebWorkerStorageUtils").createStorage(),d("WAWebSchemaLocalStorage").addTable(),d("WAWebSchemaDeferredMessagesStorage").addTable(),i=d("WAWebWorkerStorageUtils").getStorage().initialize()["catch"](function(a){d("WALogger").ERROR(h()).verbose().devConsole(a).tags("sad").sendLogs("Failed to initialize worker storage");throw a}));return i});return j.apply(this,arguments)}function e(){return d("WAWebWorkerStorageUtils").destroyStorage()["catch"](function(){return d("WAWebDexieCastTypes").dexieCastToPromise(new(c("WAWeb-dexie"))(d("WAWebWorkerStorageUtils").DATABASE_NAME)["delete"]())})["finally"](function(){i=null})}g.getLocalStorageTable=d("WAWebSchemaLocalStorage").getTable;g.getDeferredMessagesTable=d("WAWebSchemaDeferredMessagesStorage").getTable;g.initialize=a;g.destroy=e}),98);
__d("WAWebApiLocalStorage",["WAWebSchemaLocalStorage","WAWebWorkerStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebSchemaLocalStorage").getTable().get(a).then(function(a){return a==null?void 0:a.value})}function c(a){var c=a.map(function(a){return{key:a.key,value:a.value}});return d("WAWebWorkerStorageUtils").getStorage().lock(["local_storage"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];yield a.clear();yield a.bulkCreateOrReplace(c)});return function(b){return a.apply(this,arguments)}}())}function e(){return d("WAWebSchemaLocalStorage").getTable().clear()}g.getLocalStorageValue=a;g.updateLocalStorage=c;g.clearLocalStorage=e}),98);
__d("WAWebUserPrefsAppStateSync",["WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsStore","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.CRITICAL_DATA_SYNCED,!0);return c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.CRITICAL_DATA_SYNCED,!0)});return h.apply(this,arguments)}function e(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.CRITICAL_DATA_SYNCED);return a===!0}function f(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.LAST_PERIODIC_APP_STATE_SYNC_TS,a);return c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.LAST_PERIODIC_APP_STATE_SYNC_TS,a)});return i.apply(this,arguments)}function j(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.RECENT_MAILBOX_AGE_DAYS);return a}function k(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.SHOULD_CHECK_CONTACT_SYNC_STATUS,!0);return c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.SHOULD_CHECK_CONTACT_SYNC_STATUS,!0)});return l.apply(this,arguments)}function m(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.MD_SYNC_ACTIONS_ACTION_SANITIZED);return a===!0}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.MD_SYNC_ACTIONS_ACTION_SANITIZED,a),c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.MD_SYNC_ACTIONS_ACTION_SANITIZED,a)});return o.apply(this,arguments)}function p(){return c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.SYNCD_PRIMARY_ALLOWS_ALL_MUTATIONS,!0)}function q(){return!!c("WAWebUserPrefsStore").get(d("WAWebUserPrefsKeys").MD_KEYS.SYNCD_PRIMARY_ALLOWS_ALL_MUTATIONS)}function r(){return d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.NON_CRITICAL_DATA_SYNC_STATUS)}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=(yield r()))!=null?b:{};yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.NON_CRITICAL_DATA_SYNC_STATUS,babelHelpers["extends"]({},b,a))});return t.apply(this,arguments)}g.setAllCriticalDataSynced=a;g.getAllCriticalDataSynced=e;g.setLastPeriodicAppStateSyncTs=f;g.getLastPeriodicAppStateSyncTs=j;g.setShouldCheckContactSyncStatus=k;g.getMdSyncActionsActionSanitized=m;g.setMdSyncActionsActionSanitized=n;g.setPrimaryAllowsAllMutations=p;g.getPrimaryAllowsAllMutations=q;g.getNonCriticalDataSyncStatus=r;g.setNonCriticalDataSyncStatus=s}),98);
__d("WAWebSyncd",["Promise","WALogger","WASyncd","WASyncdConst","WASyncdDisabled","WAWebCmd","WAWebEventsWaitForOfflineDeliveryEnd","WAWebModelStorageUtils","WAWebSchemaSyncActions","WAWebSyncdDb","WAWebUserPrefsAppStateSync","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: invalid action ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: sanitizing null 'action' property in sync-actions table"]);j=function(){return a};return a}var k=["pending-mutations"];function a(){if(d("WASyncdDisabled").isSyncdDisabled())return(h||(h=b("Promise"))).resolve();l();d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd().then(function(){d("WASyncd").processOnAppResume()});m();return d("WASyncd").initializeStateMachine()}function l(){var a=1e3*60;a=c("lodash").debounce(d("WASyncd").reportWam,a,{maxWait:a*3});d("WAWebCmd").Cmd.on(d("WAWebCmd").APP_STATE_SYNC_COMPLETED,a)}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsAppStateSync").getMdSyncActionsActionSanitized());if(!a){d("WALogger").LOG(j());a=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().all());a=a.filter(function(a){return a.action==null});a=a.map(function(a){var b=JSON.parse(a.index)[0],c=d("WASyncdConst").Actions.cast(b);if(!c){d("WALogger").LOG(i(),b);return babelHelpers["extends"]({},a)}return babelHelpers["extends"]({},a,{action:b})});yield d("WAWebSyncdDb").updateSyncActionRows(a);yield d("WAWebUserPrefsAppStateSync").setMdSyncActionsActionSanitized(!0)}});return n.apply(this,arguments)}function e(a,c,e){a=d("WAWebModelStorageUtils").getStorage().lock([].concat(a,k),function(a){return(h||(h=b("Promise"))).all([d("WAWebSyncdDb").appendPendingMutationsRows(c),e(a)])}).then(function(){var a=c.map(function(a){return a.collection});void d("WASyncd").markCollectionsForSync(a)});return(h||(h=b("Promise"))).resolve(a)}g.initialize=a;g.sanitizeActionInSyncActionsRow=m;g.lockForSync=e}),98);
__d("WAWebABPropsCache",["WALogger","WAWebABProps","WAWebABPropsConfigs","WAWebABPropsGlobals","WAWebApiAbPropConfig","WAWebRuntimeEnvironmentUtils","cr:4941","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ABProps] configs need to be initialized before its first access, config name: ",""]);h=function(){return a};return a}var i=new Map(),j=!1,k;function a(a){k==null&&(k={},Object.keys(d("WAWebABPropsConfigs").ABPropConfigs).forEach(function(a){var b=d("WAWebABPropsConfigs").ABPropConfigs[a];b=b[0];k[b]=a}),Object.freeze(k));return k[a]}function e(){d("WAWebABProps").setGetABPropConfigValueImpl(l)}function l(a){var e=d("WAWebABPropsConfigs").ABPropConfigs[a],f=e[0],g=e[1],i=e[2];e=e[3];e=i;if(!c("gkx")("26258")&&!d("WAWebRuntimeEnvironmentUtils").isWorker()&&b("cr:4941")){i=new(b("cr:4941"))(window.location.search);i=i.get(a);if(i!=null&&i!=="")return d("WAWebApiAbPropConfig").parseConfigValue(i,g,e)}if(!j){d("WAWebABProps").usedBeforeInitializationConfigs.includes(a)||d("WALogger").WARN(h(),a);return e}return m(f)}function m(a){if(i.get(a)&&!d("WAWebABPropsGlobals").accessedConfigs.has(a)){var b;b=(b=i.get(a))==null?void 0:b.configExpoKey;b!=null&&!d("WAWebABPropsGlobals").exposureKeys.has(b)&&(d("WAWebABPropsGlobals").exposureKeys.add(b),d("WAWebABPropsGlobals").updateGlobalExpoKey());d("WAWebABPropsGlobals").accessedConfigs.add(a);d("WAWebApiAbPropConfig").setConfigAccessed(a)}b=i.get(a);return!c("gkx")("26258")&&(b==null?void 0:b.overriddenConfigValue)!=null?b.overriddenConfigValue:b==null?void 0:b.configValue}function f(){return Array.from(i.values())}function n(a){var b=!1;a.forEach(function(a){i.set(a.configCode,a),a.hasAccessed===!0&&(d("WAWebABPropsGlobals").accessedConfigs.add(a.configCode),a.configExpoKey!=null&&(d("WAWebABPropsGlobals").exposureKeys.add(a.configExpoKey),b=!0))});b&&d("WAWebABPropsGlobals").updateGlobalExpoKey();j=!0}function o(){i.clear(),d("WAWebABPropsGlobals").accessedConfigs.clear(),d("WAWebABPropsGlobals").exposureKeys.clear(),j=!1}g.getABPropConfigNameFromCode=a;g.initializeABPropsCache=e;g.getAllABPropConfigs=f;g.bulkCreateOrReplaceABPropConfigs=n;g.clearABPropConfigs=o}),98);
__d("WAWebEventSampling",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[EventSampling] override event sampling weight for ",": ",""]);h=function(){return a};return a}var i=null;function j(a){return i==null?null:i(a)}function a(a){var b=j(a);if(b!=null){d("WALogger").DEV(h(),a,b);return Math.abs(b)}return null}function b(a){i=a}g.getClientEventSamplingWeight=a;g.setGetEventSamplingConfigValueImpl=b}),98);
__d("WAWebSharedConstants",[],(function(a,b,c,d,e,f){a="__wa-mms";b="mms-type";f.IS_MMS_URL_SEARCH_PARAM=a;f.MMS_URL_MEDIA_TYPE_SEARCH_PARAM=b}),66);
__d("WAWebCryptoDecryptPartialMedia",["Promise","WALogger","WATypedArraysConcat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialMedia:getEncryptedPadding encrypt error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialMedia:getEncryptedPadding importKey error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialMedia:decrypt decrypt error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialMedia:decrypt importKey error: ",""]);l=function(){return a};return a}var m=16,n=10,o=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.ciphertext,c=a.iv;a=a.mediaKeys;a=a.encKey;c={name:"AES-CBC",iv:c};try{a=(yield self.crypto.subtle.importKey("raw",new Uint8Array(a),"AES-CBC",!1,["decrypt"])["catch"](function(a){d("WALogger").LOG(l(),String(a));throw a}));return self.crypto.subtle.decrypt(c,a,b)}catch(a){d("WALogger").LOG(k(),String(a));throw a}});return function(b){return a.apply(this,arguments)}}(),p=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.ciphertext;a=a.mediaKeys;a=a.encKey;b=b instanceof Uint8Array?b:new Uint8Array(b);b={name:"AES-CBC",iv:b.slice(0-m)};try{a=(yield self.crypto.subtle.importKey("raw",new Uint8Array(a),"AES-CBC",!1,["encrypt"])["catch"](function(a){d("WALogger").LOG(j(),String(a));return void 0}));var c=new Uint8Array([]);return self.crypto.subtle.encrypt(b,a,c)}catch(a){d("WALogger").LOG(i(),String(a));return void 0}});return function(b){return a.apply(this,arguments)}}(),q=function(a){var c=a.serverRangeStart,e=a.ciphertext;a=a.mediaKeys;var f=e instanceof Uint8Array?e:new Uint8Array(e);e=c===0;c=f.byteLength%m===0;var g=!c,i;e?i=new Uint8Array(a.iv):(i=f.slice(0,m),f=f.slice(m));g&&(f=f.slice(0,f.byteLength-n));return c?p({ciphertext:f,mediaKeys:a}).then(function(a){f=d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[f,new Uint8Array(a)]);return{ciphertext:f,iv:i}}):(h||(h=b("Promise"))).resolve({ciphertext:f,iv:i})};a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.mediaKeys;a=a.ciphertext;a=(yield q({serverRangeStart:0,ciphertext:a,mediaKeys:b}));var c=a.ciphertext;a=a.iv;return o({ciphertext:c,iv:a,mediaKeys:b})});return function(b){return a.apply(this,arguments)}}();g.BLOCK_SIZE=m;g.HMAC_SIZE=n;g.decrypt=o;g.cleanupCiphertextAndIv=q;g.decryptPartialMedia=a}),98);
__d("WAWebWamEnumCrashType",[],(function(a,b,c,d,e,f){a=Object.freeze({CRASH:0,OOM:1,MAIN_THREAD_STALL_3_SECONDS:15,MAIN_THREAD_STALL_30_SECONDS:2,MAIN_THREAD_STALL_60_SECONDS:16,MAIN_THREAD_STALL_POKED:17,MAIN_THREAD_STALL_DEBUG:3,AUDIO_TRANSCODING_ERROR:4,VIDEO_TRANSCODING_ERROR:5,ANR:6,CRITICAL_EVENT:7,UNHANDLED_EXCEPTION:8,APP_CRASH:9,NATIVE_CRASH:10,UFAD:11,EXPERIMENTAL_UFAD_DETECTION:12,UX_BREAKING_EXCEPTION:13,UX_GRACEFUL_RECOVERY_EXCEPTION:14});f.CRASH_TYPE=a}),66);
__d("WAWebCrashLogWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCrashType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CrashLog:[494,{crashContext:[3,a.TYPES.STRING],crashCount:[5,a.TYPES.INTEGER],crashReason:[2,a.TYPES.STRING],crashType:[6,d("WAWebWamEnumCrashType").CRASH_TYPE],runningTasks:[16,a.TYPES.STRING]},[1,1,100],"regular"]},{CrashLog:[]});g.CrashLogWamEvent=b}),98);
__d("WAWebCrashlogConstants",["WAWebBuildConstants"],(function(a,b,c,d,e,f,g){a="https://crashlogs.whatsapp.net/wa_fls_upload_check";b="1063127757113399|745146ffa34413f9dbb5469f5370b7af";c="https://crashlogs.whatsapp.net/wa_clb_data";e=d("WAWebBuildConstants").DYN_ORIGIN+"web-contact-us";f=0;g.CLB_CHECK_URL=a;g.CLB_TOKEN=b;g.CLB_URL=c;g.TICKET_URL=e;g.UNIQUE_UPLOADS_ALLOWED_BEFORE_THROTTLE=f}),98);
__d("WAWebCrashlogUserAgent",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a="web",b="unknown";c("gkx")("26259")?b="intern":c("gkx")("26268")?b="automation":c("gkx")("26258")&&(b="prod");return a+"_"+b}function b(a){var b=a.appVersion,c=a.browser;a=a.device;c="Web/"+c;return"WhatsApp/"+b+" "+c+" Device/"+a}g.getDistribution=a;g.getLogUserAgent=b}),98);
__d("WAWebLogLineSanitizer",[],(function(a,b,c,d,e,f){function a(a){return a.replace(/(\d){1,16}(\d{4}[@,:,-])/g,"...$2")}f.sanitizeLine=a}),66);
__d("WAMemoizeConditionally",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){var c=function c(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];var g=b?b.apply(this,e):e[0];if(g==null)return a.apply(this,e);var h=c.cache;if(h.has(g))return h.get(g);var i=a.apply(this,e);c.cache=h.set(g,i)||h;return i};c.cache=new(g.Cache||Map)();return c}g.Cache=Map;f["default"]=g}),66);
__d("WAArrayInterleave",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=[],d=a.length,e=b.length,f=Math.max(d,e);for(var g=0;g<f;g++)g<d&&c.push(a[g]),g<e&&c.push(b[g]);return c}f["default"]=a}),66);
__d("WAWebLoggerFormatMessage",["WAArrayInterleave"],(function(a,b,c,d,e,f,g){var h=4e3;function a(a,b,d,e){e===void 0&&(e=String);a=c("WAArrayInterleave")(a,b.map(e)).join("");b=d?h:Number.POSITIVE_INFINITY;a.length>b&&(a=a.slice(0,b/2)+("\n\n["+(a.length-b)+" truncated]\n\n")+a.slice(-b/2));return a}g["default"]=a}),98);
__d("WAWebLoggerOptimizer",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g="==================================================EOU",h=4e3;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b===void 0&&(b=0);c===void 0&&(c=!1);var d=[];if(c){c=(yield a.logs.orderBy("timestamp").filter(function(a){return a.timestamp>=b}).reverse().until(function(a){return a.log.includes("[sendlogs]")},!0).toArray());for(var e=c.length-1;e>=0;e--){j(c[e],d);if(c[e].log.includes(g))break}}else yield a.logs.orderBy("timestamp").filter(function(a){return a.timestamp>=b}).each(function(a){j(a,d)});return d});return i.apply(this,arguments)}function j(a,b){a.log=a.log.slice(0,h),b.push(a)}f.END_OF_UPLOAD=g;f.TRIM_LENGTH=h;f.getTimeboxedAndTrimmedLogs=a}),66);
__d("WAWebLoggerUtils",[],(function(a,b,c,d,e,f){var g=!1;function a(){return g}function b(a){g=a}function c(a){if(a<=0)return!1;return a>=1?!0:Math.random()<a}f.isWaitingForUpload=a;f.setWaitingForUpload=b;f.passesSampling=c}),66);
__d("WAWebLoggerImpl",["Promise","WAMemoizeConditionally","WAShiftTimer","WAWeb-moment","WAWebLoggerFormatMessage","WAWebLoggerOptimizer","WAWebLoggerUtils","WAWebNormalizeStack","WAWebWAWCStorage","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){var h,i="trace",j=864e5*7;c("gkx")("26258")?e=5e3:e=15e4;f=e;var k="LTSXOo+_*-=.<^!#?".split("");function a(){return k[Math.round(Math.random()*(k.length-1))]}var l=a()+a()+a()+a(),m={};m[m.ALL=0]="all";m[m.INFO=1]="info";m[m.LOG=2]="log";m[m.WARN=3]="warn";m[m.ERROR=4]="error";m[m.OFF=5]="off";e=function(){function a(a,b,e){var f=this;e===void 0&&(e=void 0);this.localCursor=0;this.writeFrom=0;this.pending=void 0;this.timer=new(d("WAShiftTimer").ShiftTimer)(function(){return f.$1()});this.runningTimestamp=0;this.isTakeOver=!1;this.log=c("WAMemoizeConditionally")(function(a,b,d,e,g){b===void 0&&(b=!1);return function(h){for(var i=arguments.length,j=new Array(i>1?i-1:0),k=1;k<i;k++)j[k-1]=arguments[k];var l=c("WAWebLoggerFormatMessage")(h,j,!b);f.logImpl(a,l,d,e,g);return l}},function(a,b,c,d,e){return c||e?null:String(a)+String(Boolean(b))+String(Boolean(d))});this.logsDBProvider=a;this.logCapacityInDatabase=b;this.logs=new Array(b);this.microStep=1/this.logCapacityInDatabase;this.processTag=e}var e=a.prototype;e.logImpl=function(a,b,e,f,g){var h=Date.now(),j=c("WAWeb-moment")(h).locale("en").format("YYYY-MM-DD HH:mm:ss.SSS:");if(!c("gkx")("26258"))try{a===m.ERROR&&(this.$2&&this.$2(b))}catch(a){}var k="";e&&((g==null?void 0:g.includes(i))?k="\n"+e.stack.split("\n").slice(3).join("\n"):k="\n"+d("WAWebNormalizeStack").normalizeStack(e,!0));a=[n(a),f&&!d("WAWebLoggerUtils").isWaitingForUpload()?"sendlogs":null].concat((e=g)!=null?e:[],[this.processTag]).filter(Boolean).map(function(a){return"["+a+"]"}).join("");f=l+" "+j+(a?a+" ":"")+b+k;this.logs[this.localCursor]={m:f,t:h};this.localCursor=(this.localCursor+1)%this.logCapacityInDatabase;this.logs[this.localCursor]!=null&&(this.writeFrom=this.localCursor);if(this.isTakeOver)return;this.timer.debounceAndCap(250,1e3)};e.$1=function(){var a=this;if(this.pending||this.logs[this.writeFrom]==null||this.isTakeOver)return;this.pending=this.logsDBProvider().then(function(c){return c.transaction("rw",c.logs,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b,d=(yield c.logs.orderBy("count").last());d||(d=(yield c.logs.orderBy("timestamp").last()));var e=d?d.line+1:0;b=((b=d)==null?void 0:b.count)?d.count+1:e;while(a.logs[a.writeFrom]!=null){d=a.logs[a.writeFrom];a.logs[a.writeFrom]=void 0;a.writeFrom=(a.writeFrom+1)%a.logCapacityInDatabase;a.runningTimestamp=d.t<=a.runningTimestamp?a.runningTimestamp+a.microStep:d.t;c.logs.put({line:e++%a.logCapacityInDatabase,log:d.m,timestamp:a.runningTimestamp,count:b++})}}))}).then(function(){a.logs[a.writeFrom]!=null&&a.timer.debounceAndCap(250,1e3)})["catch"](function(b){!c("gkx")("26258")&&a.$2&&a.$2(b.message)})["finally"](function(){a.pending=void 0})};e.getLogs=function(a,e){var f=this;a===void 0&&(a=!1);e===void 0&&(e=Date.now()-j);var g=[];this.pending&&g.push(this.pending);this.timer.isScheduled()&&(this.timer.forceRunNow(),this.pending&&g.push(this.pending));return(h||(h=b("Promise"))).all(g).then(function(){return f.logsDBProvider()}).then(function(b){return d("WAWebLoggerOptimizer").getTimeboxedAndTrimmedLogs(b,e,a)}).then(function(a){return a.map(function(a){return a.log})})["catch"](function(a){!c("gkx")("26258")&&f.$2&&f.$2(a.message);return f.logs.filter(Boolean).map(function(a){return a.m})})};e.clearLogs=function(){var a=this;return this.logsDBProvider().then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.logs.clear()});return function(b){return a.apply(this,arguments)}}())["catch"](function(){})["finally"](function(){a.localCursor=0,a.writeFrom=0,a.logs=new Array(a.logCapacityInDatabase)})};e.logUncaughtError=function(a,b){var d=a instanceof Error&&a.stack?a:void 0,e;d?e=String(a):e=b?"unhandled-rejection: "+String(a):"Error: "+String(a);this.logImpl(m.ERROR,e,d,!0,["uncaught"]);if(!c("gkx")("26258"))var f;if(b!=null){a=String(b);this.logImpl(m.WARN,a);!c("gkx")("26258")}return e};e.onTakeOver=function(){this.isTakeOver=!0};e.registerErrorNotificationListener=function(a){this.$2=a};return a}();function n(a){switch(a){case m.INFO:case m.LOG:case m.WARN:case m.ERROR:return m[a];default:throw c("err")("Unexpected numeric log level: "+a)}}a=new e(function(){return c("WAWebWAWCStorage").idb()},f);f=a.log;g.STACK_TRACE_TAG=i;g.LoggerImpl=e;g.Logger=a;g.log=f}),98);
__d("WAWebPriorLogs",["$InternalEnum","Promise","WALogger","WATimeUtils","WAWebSchemaSyncdLogs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["prior logs: error while writing to prior logs: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["prior logs: error while printing fatal logs: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["\r\n\r\nprior logs: category ",": \r\n\r\n"],["\\r\\n\\r\\nprior logs: category ",": \\r\\n\\r\\n"]);l=function(){return a};return a}var m=b("$InternalEnum")({Empty:"",Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"}),n=new Map(),o=90,p=80;function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=n.get(a))!=null?b:0;n.set(a,b+1);if(b%o===0){b=(yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().equals(["collection"],a));if(b.length<p)return;a=b.sort(function(a,b){return a.ts-b.ts}).slice(0,b.length-p).map(function(a){return a.id});yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().bulkRemove(a)}});return r.apply(this,arguments)}function a(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{yield q(a),yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().bulkCreate([{collection:a,log:b,ts:d("WATimeUtils").unixTimeMs()}])}catch(a){d("WALogger").ERROR(i(),a)}});return s.apply(this,arguments)}c=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=[].concat(Array.from(m.members()),[""]).map(function(a){return m.cast(a)}).filter(Boolean);return t(a)});return function(){return a.apply(this,arguments)}}();var t=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().equals(["collection"],a));b=b.filter(function(a){return d("WATimeUtils").happenedWithin(d("WATimeUtils").castMilliSecondsToUnixTime(a.ts),d("WATimeUtils").DAY_MILLISECONDS*60)});b=b.map(function(a){return d("WATimeUtils").toHttpHeaderDate(d("WATimeUtils").castMilliSecondsToUnixTime(a.ts))+": "+a.log+"\r\n"});d("WALogger").LOG(l(),a);a=20;for(var c=0;c<b.length;c+=a)d("WALogger").LOG(k(),b.slice(c,c+a))});return function(b){return a.apply(this,arguments)}}());yield (h||(h=b("Promise"))).all((a=a)!=null?a:[])}catch(a){d("WALogger").ERROR(j(),a)}});return function(b){return a.apply(this,arguments)}}();g.WAWebLogCategory=m;g.writePriorLog=a;g.printAllPriorLogs=c;g.printPriorLogs=t}),98);
__d("WAWebWamEnumPsCrashType",[],(function(a,b,c,d,e,f){a=Object.freeze({CRASH:0,OOM:1,MAIN_THREAD_STALL_30_SECONDS:2,MAIN_THREAD_STALL_DEBUG:3,AUDIO_TRANSCODING_ERROR:4,VIDEO_TRANSCODING_ERROR:5,ANR:6,CRITICAL_EVENT:7,UNHANDLED_EXCEPTION:8,APP_CRASH:9,NATIVE_CRASH:10,UFAD:11});f.PS_CRASH_TYPE=a}),66);
__d("WAWebCrashlog",["$InternalEnum","Promise","WALogger","WAWebBrokerGlobalAppState","WAWebBuildConstants","WAWebCrashLogWamEvent","WAWebCrashlogConstants","WAWebCrashlogUserAgent","WAWebGlobals","WAWebLogLineSanitizer","WAWebLoggerImpl","WAWebLoggerOptimizer","WAWebLoggerUtils","WAWebMiscBrowserUtils","WAWebPriorLogs","WAWebRuntimeEnvironmentUtils","WAWebURLUtils","WAWebUserPrefsMeUser","WAWebWamEnumPsCrashType","asyncToGeneratorRuntime","cr:4722","err","gkx","lodash"],(function(a,b,c,d,e,f,g){var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crash log sendLogs failed, ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crashlog:failed to parse response from upload check ",", will perform default upload"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crashlog:doUpload server configured sampling check w/rate: "," prevented upload"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crashlog:doUpload skipping sampling check"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crashlog:doUpload aborting crashlog upload due to 403 check response"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crashlog:doUpload code of "," from "," was unexpected, expected values are: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["reason for logs: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs hasTaggedMessage"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs buildId: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs distribution: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs url: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs appId: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs webPlatform: ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs platform: ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs userAgent: ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs ref: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["=================================================="]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crashlog:upload client sampling check w/rate: "," prevented upload"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs error uploading: ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs using throttle"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs reason already uploaded, skipping"]);E=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs squelched logs"]);a=function(){return b};return b}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs error logging wam event: ",""]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["wa:uploadLogs error during wam commit: ",""]);G=function(){return a};return a}var H=function(a){return new(i||(i=b("Promise")))(function(b){return self.setTimeout(b,a)})},I,J,K=b("$InternalEnum")({CRASHLOG:"crashlog",SUPPORT:"support"}),L="server-requested",M="manual-upload",N="user-report",O={electron_native:(h=d("WAWebWamEnumPsCrashType")).PS_CRASH_TYPE.NATIVE_CRASH,uncaught_error:h.PS_CRASH_TYPE.UNHANDLED_EXCEPTION,unhandled_promise:h.PS_CRASH_TYPE.UNHANDLED_EXCEPTION,sad:h.PS_CRASH_TYPE.CRITICAL_EVENT,logout:h.PS_CRASH_TYPE.APP_CRASH},P=b("$InternalEnum")({ONLY_EXCEPTION:"only_exception"}),Q=100,R=new Map(),S={shouldHitCheckEndpoint:function(){return!1},expectedCodes:[],appendToFormDataForCheck:function(a){},appendToFormDataForUpload:function(a,b){},shouldUseLightWeightLogs:function(a){return!1}},T={shouldHitCheckEndpoint:function(){return!0},expectedCodes:[200,403],appendToFormDataForCheck:function(a,b){a.append("reason",b)},appendToFormDataForUpload:function(a,b){},shouldUseLightWeightLogs:function(a){return!1}},aa={shouldHitCheckEndpoint:function(){return!0},expectedCodes:[200,403],appendToFormDataForCheck:function(a,b){a.append("support_exception_only_upload","true"),a.append("reason",b)},appendToFormDataForUpload:function(a,b){b&&b.upload===P.ONLY_EXCEPTION&&a.append("exception_only_upload","true")},shouldUseLightWeightLogs:function(a){return a?a.upload===P.ONLY_EXCEPTION:!1}};function ba(a,b,d){if(!c("gkx")("26258")&&a||d)return S;return b?aa:T}h=72e5;var U=c("lodash").throttle(X,h,{trailing:!1});function e(a){I=a}function f(a){J=a}function V(a){return W.apply(this,arguments)}function W(){W=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.reason;e=e===void 0?"reason-unspecified":e;var f=a.immediate;f=f===void 0?!1:f;var g=a.logType;g=g===void 0?K.CRASHLOG:g;var h=a.isHighPri;h=h===void 0?!1:h;var j=a.hasTaggedMessage;j=j===void 0?!1:j;var k=a.ticketId,l=a.clientSamplingRate;l=l===void 0?1:l;var m=a.tags;m=m===void 0?[]:m;a=a.fromTimestamp;if(c("WAWebBrokerGlobalAppState").isLogoutInProgress)return(i||(i=b("Promise"))).resolve();g===K.SUPPORT&&(yield d("WAWebPriorLogs").printAllPriorLogs());m=m;J&&(yield J())&&(m=m.concat("web-joined-beta"));d("WAWebRuntimeEnvironmentUtils").isWorker()&&(m=m.concat("service-worker"));l>0&&l<1&&(m=m.concat(["sampled",l.toString()]));if(R.size<=Q){var n=R.get(e);!n?R.set(e,{count:1,uploaded:!1}):n.count++}try{n=new(d("WAWebCrashLogWamEvent").CrashLogWamEvent)();n.crashReason=e;var o=m.find(function(a){return O[a]});o!=null&&(n.crashType=O[o]);m.length&&(n.crashContext=m.join(","));n.crashCount=(o=(o=R.get(e))==null?void 0:o.count)!=null?o:0;n.commitAndWaitForFlush()["catch"](function(a){d("WALogger").LOG(G(),a)})}catch(a){d("WALogger").LOG(F(),a)}if(d("WAWebLoggerUtils").isWaitingForUpload())return(i||(i=b("Promise"))).resolve();d("WAWebLoggerUtils").setWaitingForUpload(!0);if(d("WAWebLoggerUtils").passesSampling(l)){o=X;if(!h){n=R.get(e);if(n==null?void 0:n.uploaded){d("WALogger").LOG(E());d("WAWebLoggerUtils").setWaitingForUpload(!1);return}n&&(n.uploaded=!0);R.size>d("WAWebCrashlogConstants").UNIQUE_UPLOADS_ALLOWED_BEFORE_THROTTLE&&(d("WALogger").LOG(D()),o=U)}n=ba(h,j,e===L);try{o=(yield o({isHighPri:h,immediate:f,logType:g,ticketId:k,uploadStrategy:n,tags:m,reason:e,hasTaggedMessage:j,fromTimestamp:a}));d("WAWebLoggerUtils").setWaitingForUpload(!1);return o}catch(a){d("WAWebLoggerUtils").setWaitingForUpload(!1);d("WALogger").LOG(C(),a);return}}else d("WAWebLoggerUtils").setWaitingForUpload(!1),d("WALogger").LOG(B(),l)});return W.apply(this,arguments)}function X(a){return Y.apply(this,arguments)}function Y(){Y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,f=a.isHighPri;f=f===void 0?!1:f;var g=a.immediate,h=a.logType,i=a.ticketId,j=a.uploadStrategy,B=a.tags;B=B===void 0?[]:B;var C=a.reason;C=C===void 0?"reason-unspecified":C;var D=a.hasTaggedMessage;D=D===void 0?!1:D;a=a.fromTimestamp;!c("gkx")("26256")&&!c("gkx")("26258")&&(b("cr:4722")==null?void 0:b("cr:4722").logDbReadWriteStats(!0));var E=I?I():{platform:void 0,ref:void 0};d("WALogger").LOG(A());d("WALogger").LOG(z(),(e=E.ref)!=null?e:"no conn");d("WALogger").LOG(y(),navigator.userAgent);d("WALogger").LOG(x(),(e=E.platform)!=null?e:"no platform");d("WALogger").LOG(w(),d("WAWebBuildConstants").FLB_PLATFORM||"web");d("WALogger").LOG(v(),d("WAWebBuildConstants").FB_APP_ID);d("WALogger").LOG(u(),location.href);d("WALogger").LOG(t(),d("WAWebCrashlogUserAgent").getDistribution());d("WALogger").LOG(s(),d("WAWebBuildConstants").BUILD_ID||"0");D&&d("WALogger").LOG(r());d("WALogger").LOG(q(),C);d("WALogger").LOG(p(),d("WAWebLoggerOptimizer").END_OF_UPLOAD);yield H(g?0:1e3);var F;if(j.shouldHitCheckEndpoint()){E=Z({isHighPri:f});j.appendToFormDataForCheck(E,C);F=(yield self.fetch(ca(h),{method:"POST",body:E}));if(!j.expectedCodes.includes(F.status)){d("WALogger").LOG(o(),F.status,d("WAWebCrashlogConstants").CLB_CHECK_URL,j.expectedCodes.toString());return}if(F.status===403){d("WALogger").LOG(n());return}}else d("WALogger").LOG(m());e=null;if(F)try{e=JSON.parse(yield F.text());if(((D=e)==null?void 0:(g=D.config)==null?void 0:g.sampling)!=null&&(e.config.sampling===0||Math.random()*e.config.sampling>1)){d("WALogger").LOG(l(),e.config.sampling);return}}catch(a){d("WALogger").LOG(k(),String(a))}E=Z({isHighPri:f});j.appendToFormDataForUpload(E,e);D=(yield d("WAWebLoggerImpl").Logger.getLogs(j.shouldUseLightWeightLogs(e),C===L?0:a));c("gkx")("26258")&&(D=D.map(d("WAWebLogLineSanitizer").sanitizeLine));g=D.join("\n");f=new Blob([g],{type:"text/plain"});E.append("file",f,"logs.txt");B.length&&E.append("tags",B.join(","));i&&E.append("ticket_id",i);j=da(h);e=(yield self.fetch(j,{method:"POST",body:E}));if(e.status!==200)throw c("err")("Status code of "+e.status+" from "+j+" was unexpected, expected 200");return e.headers.get("X-Uploaded-File-Id")});return Y.apply(this,arguments)}function Z(a){a=a.isHighPri;var b=new FormData();(!c("gkx")("26258")||a)&&b.append("forced","true");a=d("WAWebRuntimeEnvironmentUtils").isWorker()&&!d("WAWebGlobals").areGlobalsReady()?void 0:d("WAWebUserPrefsMeUser").getMe();a&&b.append("from_jid",a.toString());a=c("WAWebMiscBrowserUtils").info();a=d("WAWebCrashlogUserAgent").getLogUserAgent({device:a.os,browser:a.ua,appVersion:d("WAWebBuildConstants").VERSION_BASE});b.append("agent",a);b.append("app_id",d("WAWebBuildConstants").FB_APP_ID);b.append("build_id",d("WAWebBuildConstants").BUILD_ID);return b}function ca(a){return c("WAWebURLUtils").build(d("WAWebCrashlogConstants").CLB_CHECK_URL,{type:String(a),access_token:d("WAWebCrashlogConstants").CLB_TOKEN})}function da(a){return c("WAWebURLUtils").build(d("WAWebCrashlogConstants").CLB_URL,{type:String(a),access_token:d("WAWebCrashlogConstants").CLB_TOKEN})}function ea(a,b,c){return $.apply(this,arguments)}function $(){$=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(d("WAWebLoggerImpl").Logger.isTakeOver)return;try{yield V({reason:a,hasTaggedMessage:!0,clientSamplingRate:(a=b)!=null?a:1,tags:c})}catch(a){d("WALogger").ERROR(j(),a)}});return $.apply(this,arguments)}function fa(){U.cancel(),R.clear()}g.LogType=K;g.SERVER_REQUESTED=L;g.MANUAL_UPLOAD=M;g.USER_REPORT=N;g.registerCrashlogUploadInformationalLoggingFunction=e;g.registerCrashlogUploadIsUserInExternalBetaFunction=f;g.upload=V;g.sendLogs=ea;g.reset=fa}),98);
__d("WAWebPwaDocumentMetadataUtils",["WAWebRuntimeEnvironmentUtils","gkx"],(function(a,b,c,d,e,f,g){var h="",i=-1,j;d("WAWebRuntimeEnvironmentUtils").isWorker()||(h=document.title);function a(a){a===void 0&&(a=null),a!=null&&(h=a),k(h)}function k(a){l()?document.title=" ":(self.clearTimeout(j),document.title+=" ",j=self.setTimeout(function(){document.title=a},0))}function b(a){a!=null&&(i=a),c("gkx")("26264")&&(l==null?void 0:l())&&"setAppBadge"in navigator&&(i===-1||i===0?navigator.clearAppBadge()["catch"](function(a){}):navigator.setAppBadge(i)["catch"](function(a){}))}function l(){return"matchMedia"in self?window.matchMedia("(display-mode: standalone)").matches:!1}g.setDocumentTitle=a;g.setAppBadge=b;g.isCurrentWebSessionInsidePwa=l}),98);
__d("WAWebUpdaterVersion",["WACustomError","WAWebBuildConstants"],(function(a,b,c,d,e,f,g){var h=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("WACustomError").customError("InvalidVersion"));b=function(){function a(a){a=a.split(".");if(a.length!==3)throw new h("Version format does not contain 3 numbers.");this.primary=Number.parseInt(a[0],10);this.secondary=Number.parseInt(a[1],10);this.tertiary=Number.parseInt(a[2],10);if(Number.isNaN(this.primary)||Number.isNaN(this.secondary)||Number.isNaN(this.tertiary))throw new h("Version contains a non-parseable string.")}var b=a.prototype;b.lt=function(b){b=b;typeof b==="string"&&(b=new a(b));return this.primary<b.primary||this.primary===b.primary&&this.secondary<b.secondary||this.primary===b.primary&&this.secondary===b.secondary&&this.tertiary<b.tertiary};b.equals=function(b){b=b;if(b==null||b==="")return!1;typeof b==="string"&&(b=new a(b));return this.primary===b.primary&&this.secondary===b.secondary&&this.tertiary===b.tertiary};b.toString=function(){return this.primary+"."+this.secondary+"."+this.tertiary};return a}();function a(a){return a.replace(/\.[di]$/,"")}c=a(d("WAWebBuildConstants").VERSION_STR);g.Version=b;g.sanitizeVersionStr=a;g.SANITIZED_VERSION_STR=c}),98);
__d("WAWebWamConstants",[],(function(a,b,c,d,e,f){a=10;b=5e4;c=5;d=300;e=100;f.PENDING_DELAY_IN_SECONDS=a;f.WAM_MAX_BUFFER_SIZE=b;f.WAM_PROTOCOL_VERSION=c;f.WAM_ROTATE_INTERVAL_IN_SECONDS=d;f.WAM_WORKER_DATA_BATCH_SIZE=e}),66);
__d("WAWebWamPlatform",["WAWebPwaDocumentMetadataUtils","gkx"],(function(a,b,c,d,e,f,g){var h="WEB";c("gkx")("26265")&&(c("gkx")("26261")?h="DARWIN_BETA":c("gkx")("26267")||c("gkx")("26266")?h="MACSTORE":h="DARWIN");function a(){return c("gkx")("26264")&&d("WAWebPwaDocumentMetadataUtils").isCurrentWebSessionInsidePwa()?"PWA":h}g.getWamPlatform=a}),98);
__d("WAQplUploader",["WALogger","WAPromiseDelays","WAPromiseRetryLoop","WAQplTypes","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader uploadChunk, retriable error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, sending rows ","-",", count ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, error during upload session, error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader upload session failed, error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, done upload."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, uploading "," rows"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, upload triggered, attempt ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, sleeping between uploads for "," ms"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, sleeping prior to start for "," ms"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, start"]);q=function(){return a};return a}var r={minTimeout:1e3,maxTimeout:1e4,retries:5,type:"exponential"},s=100,t={MAX_COUNT:4,MIN_DELAY:1*1e3*60,MAX_DELAY:15*1e3*60},u=5*60,v=24*60*60,w,x,y;function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:w=c.healthLogger;x=c.storageApi;if(!y){j.next=4;break}return j.abrupt("return");case 4:d("WALogger").DEV(q());y={sendEvents:a.sendEvents,isQplEnabled:a.isQplEnabled,startDelayInMs:1e3*((e=a.startDelayInSeconds)!=null?e:u),intervalInMs:1e3*((f=a.intervalInSeconds)!=null?f:v),minRetryDelayInMs:1e3*((g=a.minRetryDelayInSeconds)!=null?g:t.MIN_DELAY),maxRetryDelayInMs:1e3*((h=a.maxRetryDelayInSeconds)!=null?h:t.MAX_DELAY),maxRetryAttemptsCount:(i=a.maxRetryAttemptsCount)!=null?i:t.MAX_COUNT};d("WALogger").DEV(p(),y.startDelayInMs);j.next=9;return b("regeneratorRuntime").awrap(d("WAPromiseDelays").delayMs(y.startDelayInMs));case 9:j.next=11;return b("regeneratorRuntime").awrap(B());case 11:z();case 12:case"end":return j.stop()}},null,this)}function c(){return B()}function z(){d("WALogger").DEV(o(),y.intervalInMs),setTimeout(function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(B());case 2:z();case 3:case"end":return a.stop()}},null,this)},y.intervalInMs)}function A(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:a=y.minRetryDelayInMs+Math.floor(Math.random()*(y.maxRetryDelayInMs-y.minRetryDelayInMs));c.next=3;return b("regeneratorRuntime").awrap(d("WAPromiseDelays").delayMs(a));case 3:case"end":return c.stop()}},null,this)}function B(a){var c,e,f,g,h,i,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:a===void 0&&(a=0);if((c=y)==null?void 0:c.isQplEnabled()){p.next=3;break}return p.abrupt("return");case 3:d("WALogger").DEV(n(),a);p.prev=4;p.next=7;return b("regeneratorRuntime").awrap(x.getRowCount());case 7:e=p.sent,d("WALogger").DEV(m(),e),f=0;case 10:if(!(f<e)){p.next=23;break}p.next=13;return b("regeneratorRuntime").awrap(x.getFromBottom(s));case 13:g=p.sent;p.next=16;return b("regeneratorRuntime").awrap(C(g));case 16:h=g[0].id||0;i=g[g.length-1].id||0;p.next=20;return b("regeneratorRuntime").awrap(x.deleteRange(h,i));case 20:f+=g.length;p.next=10;break;case 23:d("WALogger").DEV(l());p.next=37;break;case 26:p.prev=26;p.t0=p["catch"](4);d("WALogger").DEV(k(),p.t0);if(!(a<y.maxRetryAttemptsCount)){p.next=35;break}p.next=32;return b("regeneratorRuntime").awrap(A());case 32:B(a+1);p.next=37;break;case 35:d("WALogger").ERROR(j(),p.t0).verbose().devConsole(p.t0).sendLogs("QPL Uploader upload session failed"),(o=w)==null?void 0:o.errorUploadingChunk(p.t0);case 37:case"end":return p.stop()}},null,this,[[4,26]])}function C(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"QplUploadChunk",timer:{algo:{type:r.type,first:r.minTimeout},max:r.maxTimeout},code:function(b){var c=a[0].id,e=a[a.length-1].id;d("WALogger").DEV(i(),c,e,a.length);return y.sendEvents(a).then(function(){b()})["catch"](function(a){if(a instanceof d("WAQplTypes").QplServerStatusCodeError)switch(a.statusCode){case 500:d("WALogger").WARN(h(),a.message);break;default:b();break}throw a})}});c.start();e.next=4;return b("regeneratorRuntime").awrap(c.promise());case 4:case"end":return e.stop()}},null,this)}g.start=a;g.forceQplUpload=c}),98);
__d("WAWebWamEnumPsIdAction",[],(function(a,b,c,d,e,f){a=Object.freeze({CREATED:1,ROTATED:2,DELETED:3});f.PS_ID_ACTION=a}),66);
__d("WAWebPsIdUpdateWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumPsIdAction"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PsIdUpdate:[2862,{isFromWamsys:[4,a.TYPES.BOOLEAN],psIdAction:[2,d("WAWebWamEnumPsIdAction").PS_ID_ACTION],psIdKey:[1,a.TYPES.INTEGER],psIdRotationFrequence:[3,a.TYPES.INTEGER]},[1,1,1],"regular"]},{PsIdUpdate:[]});g.PsIdUpdateWamEvent=b}),98);
__d("WAWebWebWamForceFlushWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebWamForceFlush:[3264,{},[1,1,1],"regular"]},{WebWamForceFlush:[]});g.WebWamForceFlushWamEvent=a}),98);
__d("WAWebWamUtils",["WABase64","WABinary","WALogger","WAQplUploader","WAWebPsIdUpdateWamEvent","WAWebUserPrefsGeneral","WAWebWamCodegenUtils","WAWebWamConstants","WAWebWamEnumAppBuildType","WAWebWamEnumWebcEnvCode","WAWebWamGlobals","WAWebWebWamForceFlushWamEvent","err","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["dropping invalid wam buffer"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAM: commitWorkerWamEvent failed, "," is not defined"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["force flushed all qpl buffers"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["force flushed all wam buffers"]);k=function(){return a};return a}function a(){new(d("WAWebWebWamForceFlushWamEvent").WebWamForceFlushWamEvent)().commitAndWaitForFlush(!0)["finally"](function(){return d("WALogger").LOG(k()).tags("wam")}),d("WAQplUploader").forceQplUpload()["finally"](function(){return d("WALogger").LOG(j()).tags("qpl")})}function b(a,b,c){new(d("WAWebPsIdUpdateWamEvent").PsIdUpdateWamEvent)({psIdAction:a,psIdKey:b,psIdRotationFrequence:c}).commit()}function l(a,b){b=JSON.parse(b);var c=d("WAWebWamCodegenUtils").events[a];if(c==null){d("WALogger").ERROR(i(),a).sendLogs("wam-worker-event-undefined-error");return}new c(b).commit()}function m(a,b){var c;b=JSON.parse(b);b=b.value;d("WAWebWamGlobals").Global.set((c={},c[a]=b,c))}function e(a){var b=a.action,c=a.name;a=a.payload;return b==="commit"?l(c,a):m(c,a)}function f(a){var b=!0;try{a=new(d("WABinary").Binary)(d("WABase64").decodeB64(a));b=a.size()>d("WAWebWamConstants").WAM_MAX_BUFFER_SIZE}catch(a){d("WALogger").ERROR(h())}return b}function n(a){return a==="regular"?"regular":"private"}function o(){if(c("gkx")("26258"))return d("WAWebWamEnumAppBuildType").APP_BUILD_TYPE.RELEASE;else if(c("gkx")("26259")||c("gkx")("26261"))return d("WAWebWamEnumAppBuildType").APP_BUILD_TYPE.BETA;return d("WAWebWamEnumAppBuildType").APP_BUILD_TYPE.ALPHA}function p(){if(c("gkx")("26259"))return d("WAWebWamEnumWebcEnvCode").WEBC_ENV_CODE.INTERN;else if(c("gkx")("26258"))return d("WAWebWamEnumWebcEnvCode").WEBC_ENV_CODE.PROD;else if(c("gkx")("26256"))return d("WAWebWamEnumWebcEnvCode").WEBC_ENV_CODE.E2E;throw c("err")("invalid env")}function q(){return d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaJoinedIdb()}function r(a){if(c("gkx")("26256")){var b=window.__je2e_recordWAMEvent;(b||typeof b==="function")&&b(babelHelpers["extends"]({name:a.$className},a.all))}}function s(a,b){if(c("gkx")("26256")){var d=window.__je2e_recordWAMEvent;(d||typeof d==="function")&&d({name:a,value:b})}}g.forceFlushAllWamAndQplBuffers=a;g.logPsIdUpdate=b;g.processWorkerWamDataRow=e;g.isWamBufferTooLong=f;g.getChannelFromBufferKey=n;g.getAppBuild=o;g.getWamEnv=p;g.getAppIsBetaRelease=q;g.maybeForwardWamEventToJestE2e=r;g.maybeForwardWamAttributeToJestE2e=s}),98);
__d("WAWebWamStorage",["WALogger","WAWebWAWCStorage","WAWebWamConstants","WAWebWamUtils","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processWorkerWamData failed: ","\n",""],["processWorkerWamData failed: ","\\n",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["wam: getNextSequenceNumberForStream failed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getNextSequenceNumberForStream failed: ","\n",""],["getNextSequenceNumberForStream failed: ","\\n",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteAll failed: ","\n",""],["deleteAll failed: ","\\n",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["update failed: ","\n",""],["update failed: ","\\n",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["add failed: ","\n",""],["add failed: ","\\n",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["savePsToken failed: ","\n",""],["savePsToken failed: ","\\n",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["getPsToken failed: ","\n",""],["getPsToken failed: ","\\n",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePsMeta failed: ","\n",""],["updatePsMeta failed: ","\\n",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["addPsMeta failed: ","\n",""],["addPsMeta failed: ","\\n",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["getPsMeta failed: ","\n",""],["getPsMeta failed: ","\\n",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["removePsMeta failed: ","\n",""],["removePsMeta failed: ","\\n",""]);s=function(){return a};return a}function a(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield c("WAWebWAWCStorage").idb());return f.wam.add({key:a,buffer:e,channel:b},a)["catch"](function(a){d("WALogger").LOG(m(),a,a==null?void 0:a.stack)})});return t.apply(this,arguments)}function e(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=0;try{f=(yield c("WAWebWAWCStorage").idb().then(function(c){return c.wam.update(a,{key:a,buffer:e,channel:b})}))}catch(a){d("WALogger").LOG(l(),a,a==null?void 0:a.stack)}return f!==0});return u.apply(this,arguments)}function f(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b={};try{yield c("WAWebWAWCStorage").idb().then(function(c){return c.wam.where("channel").equals(a).modify(function(a,c){b[a.key]=a.buffer,delete c.value})})}catch(a){d("WALogger").LOG(k(),a,a==null?void 0:a.stack)}return b});return v.apply(this,arguments)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=-1,f=1<<16;try{var g=(yield c("WAWebWAWCStorage").idb());yield g.transaction("rw",["wam_meta"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield g.wam_meta.where("streamId").equals(a).count());b===0?(yield g.wam_meta.add({streamId:a,seqNum:1}),e=1):yield g.wam_meta.where("streamId").equals(a).modify(function(a){e=a.seqNum+1;e>=f&&(e=1);a.seqNum=e;return a})}))}catch(a){d("WALogger").LOG(j(),a,a==null?void 0:a.stack)}if(e===-1){c("gkx")("26258")||d("WALogger").ERROR(i()).sendLogs("getNextSequenceNumberForStreamFailed");throw c("err")("could not get seq number for streamId "+a)}return e});return x.apply(this,arguments)}function y(a){return c("WAWebWAWCStorage").idb().then(function(b){return b.ps_meta.bulkDelete(a)})["catch"](function(a){d("WALogger").LOG(s(),a,a==null?void 0:a.stack)})}function z(){return c("WAWebWAWCStorage").idb().then(function(a){return a.ps_meta.toArray()})["catch"](function(a){d("WALogger").LOG(r(),a,a==null?void 0:a.stack);return[]})}function A(a){return c("WAWebWAWCStorage").idb().then(function(b){return b.ps_meta.bulkPut(a)})["catch"](function(a){d("WALogger").LOG(q(),a,a==null?void 0:a.stack)})}function B(a){return c("WAWebWAWCStorage").idb().then(function(b){return b.ps_meta.update(a.key,a)})["catch"](function(a){d("WALogger").LOG(p(),a,a==null?void 0:a.stack)})}function C(){return c("WAWebWAWCStorage").idb().then(function(a){return a.ps_tokens.get("token")})["catch"](function(a){d("WALogger").LOG(o(),a,a==null?void 0:a.stack)})}function D(a){return c("WAWebWAWCStorage").idb().then(function(b){return b.transaction("rw",["ps_tokens"],function(){return b.ps_tokens.put(a)})})["catch"](function(a){d("WALogger").LOG(n(),a,a==null?void 0:a.stack)})}function E(a,b){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=(yield c("WAWebWAWCStorage").idb());return d.transaction("rw",["core_wam","core_wam_meta"],function(){return d.core_wam.put(b).then(function(){return d.core_wam_meta.put(a)})})});return F.apply(this,arguments)}function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("WAWebWAWCStorage").idb());return b.core_wam.where("streamId").equals(a).modify({finished:!0})});return H.apply(this,arguments)}function I(a){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("WAWebWAWCStorage").idb());return b.core_wam_meta.get({streamId:a})});return J.apply(this,arguments)}function K(){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("WAWebWAWCStorage").idb());return a.core_wam.toArray()});return L.apply(this,arguments)}function M(){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("WAWebWAWCStorage").idb());return a.transaction("rw",["core_wam","core_wam_meta"],function(){return a.core_wam.clear().then(function(){return a.core_wam_meta.clear()})})});return N.apply(this,arguments)}function O(a){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("WAWebWAWCStorage").idb());return b.core_wam["delete"](a)});return P.apply(this,arguments)}function Q(a){return R.apply(this,arguments)}function R(){R=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("WAWebWAWCStorage").idb());return b.transaction("rw",["worker_wam_events"],function(){return b.worker_wam_events.put(a)})});return R.apply(this,arguments)}function S(){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("WAWebWAWCStorage").idb());try{yield a.transaction("rw",["worker_wam_events"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield a.worker_wam_events.limit(d("WAWebWamConstants").WAM_WORKER_DATA_BATCH_SIZE).modify(function(a,b){d("WAWebWamUtils").processWorkerWamDataRow(a),delete b.value})}));var e=(yield a.worker_wam_events.count());return e>0}catch(a){d("WALogger").LOG(h(),a,a==null?void 0:a.stack);return!1}});return T.apply(this,arguments)}a={add:a,update:e,deleteAll:f,getNextSequenceNumberForStream:w,addCoreWamBuffer:E,finishAllCoreWamBuffers:G,getCoreWamStartingSequenceNumber:I,getAllCoreWamBuffers:K,nukeAllCoreWamBuffers:M,removeWamBufferByKey:O,storeWorkerWamData:Q,processWorkerWamData:S,removePsMeta:y,getPsMeta:z,addPsMeta:A,updatePsMeta:B,getPsToken:C,savePsToken:D};e=a;g["default"]=e}),98);
__d("WAWebBotMessageSecret",["WABinary","WACryptoAesGcm","WACryptoHkdf","WANullthrows","WAWebDBMessageSerialization","WAWebMsgKey","WAWebMsmsgMsgSecretCache","WAWebProtobufsE2E.pb","WAWebSchemaMessage","WAWebUserPrefsMeUser","WAWebWidToJid","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h=32,i="Bot Message";function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=new(d("WABinary").Binary)(a).readByteArray();a=(yield d("WACryptoHkdf").extractAndExpand(new Uint8Array(a),i,h));return a});return k.apply(this,arguments)}function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSecretMessageSpec,a);var e=a.encIv;a=a.encPayload;var f=d("WAWebUserPrefsMeUser").assertGetMeUser();f=b.msgMeta.targetSenderJid?b.msgMeta.targetSenderJid.isSameAccount(f):!0;var g=b.msgMeta.targetChatJid?c("WANullthrows")(b.msgMeta.targetChatJid):b.msgInfo.chat;f={fromMe:f,remote:g,id:c("WANullthrows")(b.msgMeta.targetId)};b.msgInfo.chat.isGroup()&&(f.participant=b.msgMeta.targetSenderJid);g=new(c("WAWebMsgKey"))(f);f=d("WAWebMsmsgMsgSecretCache").msmsgMsgSecretCache.getMsmsgMsgSecretFromCache(g.toString());if(f==null){g=(yield d("WAWebSchemaMessage").getMessageTable().get(g.toString()));f=d("WAWebDBMessageSerialization").messageFromDbRow(c("WANullthrows")(g)).messageSecret}g=(yield j(c("WANullthrows")(f)));f=b.msgInfo.externalId;var h=b.msgMeta.targetSenderJid?d("WAWebWidToJid").widToUserJid(b.msgMeta.targetSenderJid):d("WAWebWidToJid").widToUserJid(d("WAWebUserPrefsMeUser").assertGetMeUser()),i=d("WAWebWidToJid").widToUserJid(c("WANullthrows")(b.msgInfo.author));try{var k=(yield m(f,h,i,g));k=(yield d("WACryptoAesGcm").gcmDecrypt(k,c("WANullthrows")(e),c("WANullthrows")(a),f+"\0"+i))}catch(j){f=c("WANullthrows")((b=b.msgBotInfo)==null?void 0:b.botEditTargetId);b=(yield m(f,h,i,g));k=(yield d("WACryptoAesGcm").gcmDecrypt(b,c("WANullthrows")(e),c("WANullthrows")(a),f+"\0"+i))}return k});return l.apply(this,arguments)}function m(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){a=d("WABinary").Binary.build(a,b,e).readBuffer();b=(yield d("WACryptoHkdf").extractAndExpand(new Uint8Array(c("WANullthrows")(f)),a,h));return b});return n.apply(this,arguments)}g.genBotMsgSecretFromMsgSecret=j;g.decryptMsmsgBotMessage=a}),98);
__d("WAWebCRUDOperationsNewsletterMyVotes",["Promise","WALogger","WAWebModelStorageUtils","WAWebNewsletterDBUtils","WAWebSchemaNewsletterMyVotes","WAWebWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[createOrUpdateMyVote] Invalid newsletter jid ",""]);i=function(){return a};return a}function j(a){return d("WAWebModelStorageUtils").getStorage().lock(["newsletter-my-votes"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];if(!c("WAWebWid").isNewsletter(a.chatJid)){d("WALogger").WARN(i(),a.chatJid);return}b;var e=(yield l(a.chatJid,a.msgServerId));if(e!=null&&e.serverTimestampMs>a.serverTimestampMs)return;yield b.createOrReplace(a)});return function(a){return e.apply(this,arguments)}}())}function a(a){return d("WAWebModelStorageUtils").getStorage().lock(["newsletter-my-votes"],function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];b;var d=new Map(),e=a.map(function(a){if(!c("WAWebWid").isNewsletter(a.chatJid))return;d.set(a.chatJid+"-"+a.msgServerId,a);return[a.chatJid,a.msgServerId]}).filter(Boolean);e=(yield b.anyOf(["chatJid","msgServerId"],e));e.forEach(function(a){var b=a.chatJid+"-"+a.msgServerId,c=d.get(b);c!=null&&c.serverTimestampMs<a.serverTimestampMs&&d["delete"](b)});yield b.bulkCreateOrReplace(Array.from(d.values()))});return function(a){return d.apply(this,arguments)}}())}function e(a,b){return d("WAWebSchemaNewsletterMyVotes").getTable().remove([a,b])}var k=100;function l(a,c){return!Number.isSafeInteger(c)||c<k||c>=d("WAWebNewsletterDBUtils").TEMPORARY_SERVER_ID_LOWER_BOUND?(h||(h=b("Promise"))).resolve(null):d("WAWebSchemaNewsletterMyVotes").getTable().get([a,c])}function f(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield l(a.chatJid,a.msgServerId));if(b==null)return;yield j(babelHelpers["extends"]({},b,a))});return m.apply(this,arguments)}g.createOrUpdateMyVote=j;g.bulkCreateOrUpdateMyVotes=a;g.deleteMyVote=e;g.getMyVote=l;g.updateMyVote=f}),98);
__d("WAWebNewsletterMsgEditUtils",["WAWebMsgKey","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){return babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",protocolMessageKey:a.id,latestEditMsgKey:a.id,latestEditSenderTimestampMs:a.t})}function b(a,b){var e=a.id.clone(),f=new(c("WAWebMsgKey"))({remote:a.id.remote,fromMe:a.id.fromMe,id:c("WAWebMsgKey").newId_DEPRECATED()});return babelHelpers["extends"]({},a,{id:f,type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",editMsgType:a.type,protocolMessageKey:e,latestEditMsgKey:f,latestEditSenderTimestampMs:b.latestEditSenderTimestampMs})}g.mapMsgToEditProtocolMsgLegacy=a;g.mapMsgToEditProtocolMsg=b}),98);
__d("WAWebNewsletterMsgStanzaAdapters",["WAAckLevel","WAWebMsgKey","WAWebMsgType","WAWebNewsletterMsgEditUtils","WAWebUserPrefsMeUser","err"],(function(a,b,c,d,e,f,g){function a(a,b,e){if(e.addOnParentKey==null)throw c("err")("Reaction message without parent");return{id:a,reactionParentKey:e.addOnParentKey,type:d("WAWebMsgType").MSG_TYPE.REACTION,kind:d("WAWebMsgType").MsgKind.ReactionDecrypted,t:b.t,from:b.from,to:b.to,serverId:b.serverId,isNewMsg:!1,ack:d("WAAckLevel").ACK.SENT,read:!1,reactionText:b.reactionCode,reactionTimestamp:b.t*1e3}}function b(a,b,e){if(e.addOnParentKey==null)throw c("err")("Reaction message without parent");return{id:a,t:b.t,from:b.from,to:b.to,serverId:b.serverId,isNewMsg:!1,ack:d("WAAckLevel").ACK.SENT,type:d("WAWebMsgType").MSG_TYPE.POLL_UPDATE,kind:d("WAWebMsgType").MsgKind.PollVoteDecrypted,subtype:"poll_vote",pollUpdateParentKey:e.addOnParentKey,selectedOptionLocalIds:(a=e.pollVotesAsLocalIds)!=null?a:[],senderTimestampMs:b.t*1e3,read:!1}}function e(a){var b=a.msgKey,e=a.msg,f=a.msgContext,g=a.baseMsgData;a=a.parsingContext;if(a==="history"){return{id:new(c("WAWebMsgKey"))({remote:e.from,fromMe:e.isSender,id:e.id}),from:e.from,to:e.isSender?e.from:d("WAWebUserPrefsMeUser").getMeUser(),t:(a=f.metaOriginalMsgT)!=null?a:e.t,serverId:e.serverId,lastUpdateFromServerTs:(a=f.lastUpdateFromServerTs)!=null?a:void 0,type:"revoked",kind:d("WAWebMsgType").MsgKind.RevokedMessage,revokeSender:e.from,subtype:"admin"}}return babelHelpers["extends"]({},g,{serverId:e.serverId,id:new(c("WAWebMsgKey"))({remote:e.from,fromMe:e.isSender,id:c("WAWebMsgKey").newId_DEPRECATED()}),type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.ProtocolRevoke,subtype:"admin_revoke",protocolMessageKey:b})}function f(a,b,c){return b!=="history"?d("WAWebNewsletterMsgEditUtils").mapMsgToEditProtocolMsg(a,{latestEditSenderTimestampMs:c.latestEditSenderTimestampMs}):a}g.mapReactionMsgStanza=a;g.mapPollVoteMsgStanza=b;g.mapRevokeMsgStanza=e;g.mapEditMsgStanza=f}),98);
__d("WAWebNewsletterBackendMsgUtils",["WAAckLevel","WATimeUtils","WAWebE2EProtoParser","WAWebMsgKey","WAWebMsgType","WAWebNewsletterFutureProofUtils","WAWebNewsletterMsgStanzaAdapters","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){function h(a,b){var e=a.msg;a=a.msgContext;var f=new(c("WAWebMsgKey"))({remote:e.from,fromMe:e.isSender,id:e.id});switch(e.type){case"NewsletterReaction":case"NewsletterReactionRevoke":return d("WAWebNewsletterMsgStanzaAdapters").mapReactionMsgStanza(f,e,a);case"NewsletterPollVote":return d("WAWebNewsletterMsgStanzaAdapters").mapPollVoteMsgStanza(f,e,a)}var g=j(f,e);if(e.type==="NewsletterRevoke")return d("WAWebNewsletterMsgStanzaAdapters").mapRevokeMsgStanza({msgKey:f,msg:e,msgContext:a,baseMsgData:g,parsingContext:b});var h=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,e.payload);h=d("WAWebE2EProtoParser").parseMsgProto(h,g,b);g=i(babelHelpers["extends"]({},h,{isNewMsg:a.isNewMsg,viewCount:(g=a.viewCount)!=null?g:void 0,hasReaction:!!a.hasReaction,latestEditSenderTimestampMs:a.latestEditSenderTimestampMs,lastUpdateFromServerTs:(g=a.lastUpdateFromServerTs)!=null?g:void 0,latestEditMsgKey:a.isEdited===!0?f:void 0,serverId:e.serverId}));d("WAWebNewsletterFutureProofUtils").isMsgSupported(h)||(g.type=d("WAWebMsgType").MSG_TYPE.UNKNOWN,g.kind=d("WAWebMsgType").MsgKind.Unknown,g.futureproofType=h.type,g.futureproofSubtype=h.subtype);switch(e.type){case"NewsletterEdit":return d("WAWebNewsletterMsgStanzaAdapters").mapEditMsgStanza(g,b,a);case"NewsletterPollCreation":case"NewsletterText":case"NewsletterMedia":return g;default:e.type;throw c("err")("unreachable code")}}function i(a){a.streamingSidecar=null;a.mediaKey=null;a.mediaKeyTimestamp=null;return a}function a(a,b,c,e){c===void 0&&(c=!1);var f=a.newsletterMessageHistoryContent,g=a.id,i=a.t,j=a.serverId;if(f==null||g==null||i==null)return null;var k=a.isSender==="true";g={id:g,from:b,isSender:k,to:k?b:d("WAWebUserPrefsMeUser").getMeUser(),t:i,serverId:j,offline:!1};b=(k=a.newsletterMessageOriginalTimestampMixin)==null?void 0:k.metaOriginalMsgT;k={hasReaction:c,lastUpdateFromServerTs:e,viewCount:(j=a.newsletterViewsCountMixin)==null?void 0:j.viewsCountCount,isEdited:f.name==="NewsletterEdit",metaOriginalMsgT:b};c="history";switch(f.name){case"NewsletterEdit":j=(e=a.newsletterMessageLastEditTimestampMixin)==null?void 0:e.metaMsgEditT;a=j!=null?d("WATimeUtils").castToMillisTime(j):void 0;b=(e=b)!=null?e:i;return h({msg:babelHelpers["extends"]({},g,{type:f.name,t:b,payload:f.value.newsletterTextOrMediaMixinGroup.value.plaintextPayloadMixin.elementValue,msgEditT:j,msgOriginalT:i}),msgContext:babelHelpers["extends"]({},k,{latestEditSenderTimestampMs:a})},c);case"NewsletterText":return h({msg:babelHelpers["extends"]({},g,{payload:f.value.plaintextPayloadMixin.elementValue,type:f.name}),msgContext:k},c);case"NewsletterPollCreation":return h({msg:babelHelpers["extends"]({},g,{payload:f.value.plaintextPayloadMixin.elementValue,type:f.name}),msgContext:k},c);case"NewsletterMedia":return h({msg:babelHelpers["extends"]({},g,{payload:f.value.plaintextPayloadMixin.elementValue,type:f.name}),msgContext:k},c);case"NewsletterRevoke":return h({msg:babelHelpers["extends"]({},g,{type:f.name}),msgContext:k},c);default:f.name;return null}}function j(a,b){return{ack:d("WAAckLevel").ACK.SENT,from:b.from,t:b.t,to:b.to,id:a,type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,count:null,invis:!1}}g.mapMsgStanzaToMsgData=h;g.mapNewsletterMsgToMsgData=a}),98);
__d("WAWebNewsletterPollsVotesUtils",["WABase64","WAHex","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield self.crypto.subtle.digest("SHA-256",new TextEncoder().encode(a)));return d("WAHex").toHex(new Uint8Array(a))});return h.apply(this,arguments)}function c(a){return d("WAHex").toHex(a)}function e(a){return d("WAHex").toHex(new Uint8Array(d("WABase64").decodeB64(a))).toUpperCase()}g.getPollOptionHash=a;g.bufferToHex=c;g.base64ToHex=e}),98);/*FB_PKG_DELIM*/
__d("ServerTime",["ServerTimeData"],(function(a,b,c,d,e,f,g){var h,i=0;f=0;var j=null;h=(h=(typeof window!=="undefined"?window:self).performance)==null?void 0:h.timing;if(h){var k=h.requestStart;h=h.domLoading;if(k&&h){var l=c("ServerTimeData").timeOfResponseStart-c("ServerTimeData").timeOfRequestStart;k=h-k-l;f=k/2;l=h-c("ServerTimeData").timeOfResponseStart-f;h=Math.max(50,k*.8);Math.abs(l)>h&&(i=l,j=Date.now())}}else d(c("ServerTimeData").serverTime);function a(){return Date.now()-i}function b(){return i}function d(a){a=Date.now()-a;Math.abs(i-a)>6e4&&(i=a,j=Date.now())}function e(){return j===null?null:Date.now()-j}f=a;k=b;g.getMillis=a;g.getOffsetMillis=b;g.update=d;g.getMillisSinceLastUpdate=e;g.get=f;g.getSkew=k}),98);
__d("guid",[],(function(a,b,c,d,e,f){function a(){if(typeof crypto==="object"&&typeof crypto.getRandomValues==="function"&&typeof String.prototype.padStart==="function"){var a=crypto.getRandomValues(new Uint32Array(2));return"f"+a[0].toString(16).padStart(8,"0")+a[1].toString(16).padStart(8,"0")}return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")}f["default"]=a}),66);
__d("OdsWebBatchFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1838142");b=d("FalcoLoggerInternal").create("ods_web_batch",a);e=b;g["default"]=e}),98);
__d("FalcoConsentChecker",[],(function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){var e;switch(typeof d){case"string":e=a[String(d)];return!e?!1:e<=b;case"number":return g(a,b,c,c[Number(d)]);default:e=!1;if(Array.isArray(d)){var f=d[0];for(var h=1;h<d.length;h++){e=g(a,b,c,d[h]);if(e){if(f==="or")return!0}else if(f==="and")return!1}}return e}}f["default"]=g}),66);
__d("pageID",["WebSession"],(function(a,b,c,d,e,f,g){"use strict";a=d("WebSession").getPageId_DO_NOT_USE();g["default"]=a}),98);
__d("WebStorageMutex",["WebStorage","clearTimeout","pageID","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=!1,k=c("pageID");function l(){j||(j=!0,i=(h||(h=c("WebStorage"))).getLocalStorage());return i}a=function(){function a(a){this.name=a}a.testSetPageID=function(a){k=a};var b=a.prototype;b.$2=function(){var a,b=l();if(!b)return k;b=b.getItem("mutex_"+this.name);b=((a=b)!=null?a:"").split(":");return b&&parseInt(b[1],10)>=Date.now()?b[0]:null};b.$3=function(a){var b=l();if(!b)return;a=a==null?1e3:a;a=Date.now()+a;(h||(h=c("WebStorage"))).setItemGuarded(b,"mutex_"+this.name,k+":"+a)};b.hasLock=function(){return this.$2()===k};b.lock=function(a,b,d){var e=this;this.$1&&c("clearTimeout")(this.$1);k===(this.$2()||k)&&this.$3(d);this.$1=c("setTimeout")(function(){e.$1=null;var c=e.hasLock()?a:b;c&&c(e)},0)};b.unlock=function(){this.$1&&c("clearTimeout")(this.$1);var a=l();a&&this.hasLock()&&a.removeItem("mutex_"+this.name)};return a}();g["default"]=a}),98);
__d("PersistedQueue",["AnalyticsCoreData","BaseEventEmitter","ExecutionEnvironment","Run","WebStorage","WebStorageMutex","cr:8958","err","guid","nullthrows","performanceAbsoluteNow","requestAnimationFrame"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=24*60*60*1e3,m=30*1e3,n=new(c("BaseEventEmitter"))(),o;function p(a){a===void 0&&(a=!1);if(o===void 0){var b;if(((b=(h||(h=c("AnalyticsCoreData"))).queue_activation_experiment)!=null?b:!1)&&a)try{return(i||(i=c("WebStorage"))).getLocalStorageForRead()}catch(a){return null}b="check_quota";try{a=(i||(i=c("WebStorage"))).getLocalStorage();a?(a.setItem(b,b),a.removeItem(b),o=a):o=null}catch(a){o=null}}return o}function q(a){var b=a.prev,c=a.next;c&&(c.prev=b);b&&(b.next=c);a.next=null;a.prev=null}function r(a){return{item:a,next:null,prev:null}}function s(a,b){return a+"^$"+((a=b==null?void 0:b.queueNameSuffix)!=null?a:"")}var t={},u={},v={},w=!1;a=function(){function a(a,b){var d,e=this;this.$7=0;this.$3=a;this.$5=(d=b==null?void 0:b.queueNameSuffix)!=null?d:"";this.$15=b==null?void 0:b.application;this.$4=s(a,b);this.$11=this.$4+"^$"+c("guid")();this.$14=!1;if(b){this.$8=(d=b.max_age_in_ms)!=null?d:l;this.$12=b.migrate;this.$13=b.onLoad}else this.$8=l;this.$9=[n.addListener("active",function(){(e.$10!=null||!e.$14)&&(e.$14=!0,e.$10=null,e.$16())}),n.addListener("inactive",function(){e.$10==null&&(e.$10=Date.now(),e.$17())})];((j||(j=c("ExecutionEnvironment"))).canUseDOM||(j||(j=c("ExecutionEnvironment"))).isInWorker)&&c("requestAnimationFrame")(function(){return e.$16()})}var d=a.prototype;d.isActive=function(){var a=this.$10;if(a==null)return!0;if(Date.now()-a>m){this.$10=null;n.emit("active",null);return!0}return!1};d.$16=function(){this.$18(),this.$19()};d.$17=function(){this.$20()};d.getFullName=function(){return this.$4};d.getQueueNameSuffix=function(){return this.$5};a.isQueueActivateExperiment=function(){return w};a.setOnQueueActivateExperiment=function(){w=!0};a.create=function(b,d){var e=s(b,d);if(e in t)throw c("err")("Duplicate queue created: "+b);d=new a(b,d);t[e]=d;v[b]?v[b].push(d):v[b]=[d];e=u[b];e&&d.setHandler(e);return d};a.setHandler=function(a,b){if(v[a]){var c=v[a];for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;f.setHandler(b)}}u[a]=b};d.destroy=function(){this.$9.forEach(function(a){return a.remove()})};a.destroy=function(a,b){a=s(a,b);t[a].destroy();delete t[a]};d.setHandler=function(a){this.$6=a;this.$19();return this};d.$19=function(){this.$7>0&&this.$6&&this.$6(this)};d.length=function(){return this.$7};d.enumeratedLength=function(){return this.$21().length};a.isPersistenceAllowed=function(){var a=p();return!a?!1:!0};a.getSuffixesForKey=function(a){var b=[];try{var c=p(!0);if(!c)return b;a=a+"^$";for(var d=0;d<c.length;d++){var e=c.key(d);if(typeof e==="string"&&e.startsWith("mutex_falco_"))c.removeItem(e);else if(typeof e==="string"&&e.startsWith(a)){e=e.split("^$");if(e.length>2){e=e[1];b.push(e)}else b.push("")}}}catch(a){}return b};d.$18=function(){var d,e=this,a=p(!0);if(!a)return;var f=this.$4+"^$";d=new(c("WebStorageMutex"))((d=this.$15)!=null?d:f);var g=this.$12,h=this.$13;d.lock(function(d){var i=Date.now()-e.$8;try{for(var j=0;j<a.length;j++){var k=a.key(j);if(typeof k==="string"&&k.startsWith(f)){var l=a.getItem(k);a.removeItem(k);if(l!=null&&l.startsWith("{")){k=b("cr:8958").parse(c("nullthrows")(l));if(k.ts>i)try{for(var l=k.items,k=Array.isArray(l),m=0,l=k?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var n;if(k){if(m>=l.length)break;n=l[m++]}else{m=l.next();if(m.done)break;n=m.value}n=n;g!=null?g(n):n;n=h!=null?h(n):n;e.$22(n)}}catch(a){}}}}}catch(a){}d.unlock();e.$19()})};d.$20=function(){var a=p();if(!a)return;var d=this.$21();if(d.length===0){a.getItem(this.$11)!=null&&a.removeItem(this.$11);return}(i||(i=c("WebStorage"))).setItemGuarded(a,this.$11,b("cr:8958").stringify({items:d.map(function(a){return a}),ts:(k||(k=c("performanceAbsoluteNow")))()}))};d.$21=function(){var a=this.$1,b=[];if(!a)return b;do b.push(a.item);while(a=a.prev);return b.reverse()};d.markItemAsCompleted=function(a){var b=a.prev;q(a);this.$1===a&&(this.$1=b);this.$7--;this.isActive()||this.$20()};d.markItemAsFailed=function(a){q(a);var b=this.$2;if(b){var c=b.prev;c&&(c.next=a,a.prev=c);a.next=b;b.prev=a}this.$2=a;this.isActive()&&this.$19()};d.markItem=function(a,b){b?this.markItemAsCompleted(a):this.markItemAsFailed(a)};d.$22=function(a){a=r(a);var b=this.$1;b&&(b.next=a,a.prev=b);this.$1=a;this.$2||(this.$2=a);this.$7++};d.wrapAndEnqueueItem=function(a){this.$22(a),this.isActive()?this.$19():this.$20()};d.dequeueItem=function(){if(this.$10!=null)return null;var a=this.$2;if(!a)return null;this.$2=a.next;return a};return a}();a.eventEmitter=n;if((j||(j=c("ExecutionEnvironment"))).canUseDOM){var x=d("Run").maybeOnBeforeUnload(function(){n.emit("inactive",null),x==null?void 0:x.remove()},!1);if(!x)var y=d("Run").onUnload(function(){n.emit("inactive",null),y.remove()})}g["default"]=a}),98);
__d("FalcoLoggerInternal",["AnalyticsCoreData","BaseEventEmitter","FBLogger","FalcoConsentChecker","FalcoUtils","PersistedQueue","Promise","Random","ServerTime","nullthrows","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("FalcoUtils").getTaggedBitmap(33),l=d("FalcoUtils").getTaggedBitmap(0),m=500*1024*.6,n=new Map(),o=new Set(["cmcd_messenger_web_logging_event","javascript_web_error","comet_redblock"]);function p(a){var b;a.tags=d("FalcoUtils").xorBitmap((b=a.tags)!=null?b:[0,0],k);return a}function a(a,b){var d;d=(d=c("PersistedQueue").getSuffixesForKey(a))!=null?d:[];d.push(b);for(var d=d,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g,h;if(e){if(f>=d.length)break;h=d[f++]}else{f=d.next();if(f.done)break;h=f.value}h=h;var j=a+"^$"+h;if(n.has(j))continue;g=((g=(i||(i=c("AnalyticsCoreData"))).use_falco_as_mutex_key)!=null?g:!1)?c("PersistedQueue").create(a,{onLoad:p,queueNameSuffix:h,application:"falco"}):c("PersistedQueue").create(a,{onLoad:p,queueNameSuffix:h});n.set(j,g)}return c("nullthrows")(n.get(a+"^$"+b))}f=d("FalcoUtils").identityToString((i||(i=c("AnalyticsCoreData"))).identity);var q=a("falco_queue_log",f),r=a("falco_queue_immediately",f),s=a("falco_queue_critical",f),t=new(c("BaseEventEmitter"))(),u=new(c("BaseEventEmitter"))(),v={};function w(a,b,e){var f=c("Random").coinflip(b.r);if(!f){d("FalcoUtils").bumpODSMetrics(e,"event.filters.sampling",1);return!1}f=b.c;if(f!=null&&(i||(i=c("AnalyticsCoreData"))).consents!=null){b=x(f,(i||(i=c("AnalyticsCoreData"))).consents,a);if(!b){d("FalcoUtils").bumpODSMetrics(e,"event.filters.consent",1);return!1}}return!0}function x(a,b,d){var e=v[a];e==null&&(e=v[a]=JSON.parse(a));return c("FalcoConsentChecker")(b,d,e,e[0])}function y(){return(j||(j=c("performanceAbsoluteNow")))()-d("ServerTime").getOffsetMillis()}function z(a,b,d,e,f,g){A(a,b,d,e,f,g);if((i||(i=c("AnalyticsCoreData"))).enable_observer){a=babelHelpers["extends"]({name:a,time:b,sampled:d,getData:f,policy:e},g&&{getPrivacyContext:g});t.emit("event",a)}}function A(a,b,d,e,f,g){if((i||(i=c("AnalyticsCoreData"))).enable_cmcd_observer&&!o.has(a)){a=babelHelpers["extends"]({name:a,time:b,sampled:d,getData:f,policy:e},g&&{getPrivacyContext:g});u.emit("cmcd_detection_event",a)}}function B(a,b,e,f,g,h){g=JSON.stringify(g);if(g.length>m){d("FalcoUtils").bumpODSMetrics(a,"event.filters.exceeded_size",1);c("FBLogger")("falco","oversized_message:"+a).warn('Dropping event "%s" due to exceeding the max size %s at %s',a,m,g.length);return}h.wrapAndEnqueueItem({name:a,policy:b,time:e,extra:g,privacyContext:f,tags:d("FalcoUtils").xorBitmap([0,0],l)});d("FalcoUtils").bumpODSMetrics(a,"event.captured",1)}function C(a,b,c,e,f){try{var g=y();d("FalcoUtils").bumpODSMetrics(a,"event.logged",1);var h=w(g,b,a);if(h){var i=e(),j=c&&c();B(a,b,g,j,i,f)}z(a,g,h,b,e,c)}catch(a){E(a)}}function D(a,c,e,f,g){try{var i=y();d("FalcoUtils").bumpODSMetrics(a,"event.logged",1);var j=w(i,c,a);if(j){var k=f(),l=(h||(h=b("Promise"))).resolve(e&&e());return h.all([k,l]).then(function(b){var d=b[0],e=b[1];B(a,c,i,e,d,g);z(a,i,j,c,function(){return d},e&&function(){return e})})}else{z(a,i,j,c,f,e);return(h||(h=b("Promise"))).resolve()}}catch(a){return(h||(h=b("Promise"))).reject(a)}}function E(a){var b=c("FBLogger")("falco");a instanceof Error?b.catching(a).warn("Error while attempting to log to Falco"):b.warn("Caught non-error while attempting to log to Falco: %s",JSON.stringify(a))}function e(a,b){return{log:function(c,d){C(a,b,d,c,q)},logAsync:function(c,d){D(a,b,d,c,q)["catch"](E)},logImmediately:function(c,d){C(a,b,d,c,r)},logCritical:function(c,d){C(a,b,d,c,s)},logRealtimeEvent:function(c,d){C(a,b,d,c,s)}}}g.observable=t;g.cmcdObservable=u;g.create=e}),98);
__d("FalcoUtils",["AnalyticsCoreData","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="ods_web_batch";function a(a){if(a){var b=a.fbIdentity,c=a.appScopedIdentity;a=a.claim;var d="";if(b){var e=b.accountId;b=b.actorId;d=e+"^#"+b+"^#"}else c!==void 0&&(d="^#^#"+c);return d+"^#"+a}return""}function b(a){return a>30?[0,1<<a-30]:[1<<a,0]}function e(a,b){return[a[0]|b[0],a[1]|b[1]]}function f(a,b,e){if(a===j)return;(i||(i=d("ODS"))).bumpEntityKey(7173,"entities.ff_js_web."+a+"."+(h||(h=c("AnalyticsCoreData"))).app_id+"."+((a=(h||(h=c("AnalyticsCoreData"))).app_version)!=null?a:"0")+"."+h.push_phase,b,e)}g.identityToString=a;g.getTaggedBitmap=b;g.xorBitmap=e;g.bumpODSMetrics=f}),98);
__d("ODS",["ExecutionEnvironment","OdsWebBatchFalcoEvent","Random","Run","clearTimeout","gkx","setTimeout","unrecoverableViolation"],(function(a,b,c,d,e,f,g){var h,i,j=(h||(h=c("ExecutionEnvironment"))).canUseDOM||(h||c("ExecutionEnvironment")).isInWorker,k={};function l(a,b,c,d,e){var f;d===void 0&&(d=1);e===void 0&&(e=1);var g=(f=k[b])!=null?f:null;if(g!=null&&g<=0)return;i=i||{};var h=i[a]||(i[a]={}),j=h[b]||(h[b]={}),l=j[c]||(j[c]=[0,null]),m=Number(d),o=Number(e);g>0&&(m/=g,o/=g);if(!isFinite(m)||!isFinite(o))return;l[0]+=m;if(arguments.length>=5){var p=l[1];p==null&&(p=0);l[1]=p+o}n()}var m;function n(){if(m!=null)return;m=c("setTimeout")(function(){o()},c("gkx")("20935")?13e3/2:5e3)}function a(a,b){if(!j)return;k[a]=d("Random").random()<b?b:0}function b(a,b,c,d){d===void 0&&(d=1);if(!j)return;l(a,b,c,d)}function e(a,b,c,d,e){d===void 0&&(d=1);e===void 0&&(e=1);if(!j)return;l(a,b,c,d,e)}function o(a){a===void 0&&(a="normal");if(!j)return;c("clearTimeout")(m);m=null;if(i==null)return;var b=i;i=null;function d(){return{batch:b}}a==="critical"?c("OdsWebBatchFalcoEvent").logCritical(d):c("OdsWebBatchFalcoEvent").log(d)}j&&d("Run").onUnload(function(){o("critical")});g.setEntitySample=a;g.bumpEntityKey=b;g.bumpFraction=e;g.flush=o}),98);
__d("Qe2JsExposureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1837559");b=d("FalcoLoggerInternal").create("qe2_js_exposure",a);e=b;g["default"]=e}),98);
__d("QE2Logger",["Qe2JsExposureFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h={};function a(a,b){F(a,(a=b)!=null?a:"",9)}function b(a,b){F(a,(a=b)!=null?a:"",9,!0)}function d(a){F(a,"",4)}function e(a){F(a,"",32)}function f(a){F(a,"",32,!0)}function i(a){F(a,"",54)}function j(a){F(a,"",54,!0)}function k(a,b){F(a,b,3)}function l(a){F(a,"",5)}function m(a){F(a,"",5,!0)}function n(a){F(a,"",31)}function o(a){F(a,"",98)}function p(a,b){F(a,b,7)}function q(a,b){F(a,b,55)}function r(a,b){F(a,b,17)}function s(a,b){F(a,b,25)}function t(a,b){F(a,b,115)}function u(a,b){F(a,b,8)}function v(a,b){F(a,b,22)}function w(a,b){F(a,b,27)}function x(a,b){F(a,b,0)}function y(a,b){F(a,(a=b)!=null?a:"",89)}function z(a,b){F(a,(a=b)!=null?a:"",89,!0)}function A(a,b){F(a,b,60)}function B(a,b){F(a,b,90)}function C(a,b){F(a,b,144)}function D(a,b,c){F(a,b,c)}function E(a,b,c){F(a,b,c,!0)}function F(a,b,d,e){var f=a+"|"+b;if(h[f])return;e===!0?c("Qe2JsExposureFalcoEvent").logImmediately(function(){return{universe:a,unit_id:b,unit_type:d}}):c("Qe2JsExposureFalcoEvent").log(function(){return{universe:a,unit_id:b,unit_type:d}});h[f]=!0}g.logExposureForUser=a;g.logExposureForUserImmediately=b;g.logExposureForIGDjangoUser=d;g.logExposureForIGUser=e;g.logExposureForIGUserImmediately=f;g.logExposureForIGWebCookie=i;g.logExposureForIGWebCookieImmediately=j;g.logExposureForEmail=k;g.logExposureForDatr=l;g.logExposureForDatrImmediately=m;g.logExposureForOculusLoggedOut=n;g.logExposureForOculusLoggedOutCookieID=o;g.logExposureForPage=p;g.logExposureForPaymentAccountID=q;g.logExposureForBusiness=r;g.logExposureForGroup=s;g.logExposureForPhabricatorDiff=t;g.logExposureForPhoneNumber=u;g.logExposureForScimCompanyID=v;g.logExposureForAnalyticsEntityID=w;g.logExposureForAdAccountID=x;g.logExposureForActingAccount=y;g.logExposureForActingAccountImmediately=z;g.logExposureForMixedUserAndPage=A;g.logExposureForCommerceMerchantSettings=B;g.logExposureForShopifyApplicationInstallationID=C;g.logExposure=D;g.logExposureImmediately=E}),98);
__d("FbtLogging",["QE2Logger","cr:1094907","cr:1290","cr:8828"],(function(a,b,c,d,e,f,g){"use strict";d("QE2Logger").logExposureForUser("fbt_js_performance_testing");a=b("cr:1290")==null?void 0:b("cr:1290").JHashToSampleRate;c=b("cr:1094907")==null?void 0:b("cr:1094907").logImpression;e=b("cr:8828")==null?void 0:b("cr:8828").logImpressionV2;g.m=a;g.logImpression=c;g.logImpressionV2=e}),98);
__d("IntlQtEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1848815");b=d("FalcoLoggerInternal").create("intl_qt_event",a);e=b;g["default"]=e}),98);/*FB_PKG_DELIM*/
__d("WAWebDBNoteDatabaseApi",["WALogger","WAWebSchemaNote","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[getOnlyNoteByChatJid] Found more than one note for chatJid ","."]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebSchemaNote").getNoteTable().createOrReplace(a)});return i.apply(this,arguments)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebSchemaNote").getNoteTable().equals(["chatJid"],a);return a});return k.apply(this,arguments)}function c(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield j(a));b.length>1&&d("WALogger").ERROR(h(),a).devConsole(b);return b.length>0?b[0]:null});return l.apply(this,arguments)}function e(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebSchemaNote").getNoteTable().bulkCreateOrMerge(a)});return m.apply(this,arguments)}g.addOrEditNote=a;g.getNotesByChatJid=j;g.getOnlyNoteByChatJid=c;g.bulkUpdateNotes=e}),98);
__d("WAWebNoteModel",["WAWebBaseModel"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.id=d("WAWebBaseModel").prop(),c.type=d("WAWebBaseModel").prop(),c.chatJid=d("WAWebBaseModel").prop(),c.content=d("WAWebBaseModel").prop(),c.createdAt=d("WAWebBaseModel").prop(),c.modifiedAt=d("WAWebBaseModel").prop(),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.initialize=function(){a.prototype.initialize.call(this)};return b}(d("WAWebBaseModel").BaseModel);a.Proxy="note";b=d("WAWebBaseModel").defineModel(a);g.Note=b}),98);
__d("WAWebNoteCollection",["WAWebBaseCollection","WAWebNoteModel"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;b=a.call(this)||this;b.queriedChatJids=new Set();return b}var c=b.prototype;c.maybeGetNoteByChatJid=function(a){var b=this.findFirst(function(b){return b.chatJid===a});return(b=b)!=null?b:null};c.hasCachedQueryForChatJid=function(a){return this.queriedChatJids.has(a)};c.updateCollectionFromDB=function(a,b){this.queriedChatJids.add(a);if(b==null)return;this.add(new(d("WAWebNoteModel").Note)(b),{merge:!0})};c.purgeNotesByChatJid=function(a){var b=this.where({chatJid:a});this.remove(b);this.queriedChatJids["delete"](a)};return b}(d("WAWebBaseCollection").BaseCollection);a.model=d("WAWebNoteModel").Note;b=new a();g.NoteCollectionImpl=a;g.NoteCollection=b}),98);
__d("WAWebNoteSync",["Promise","WAJids","WALogger","WALongInt","WAServerSync.pb","WASyncAction.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst","WAWebBaseModel","WAWebNoteAction","WAWebNoteCollection","WAWebSchemaNote","WAWebSyncdActionUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["noteEditAction.unstructuredContent is empty"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["noteEditAction.createdAt is a non-safe integer"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["noteEditAction.createdAt is empty"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["noteEditAction.chatJid is not a valid chatJid"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["noteEditAction.chatJid is empty"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["noteEditAction.type is empty"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["note sync: malformed mutation"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["note sync: operation not supported"]);p=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var e=c.prototype;e.getVersion=function(){return 7};e.getAction=function(){return d("WASyncdConst").Actions.NoteEdit};e.applyMutations=function(a){return(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.operation!=="set"){d("WALogger").WARN(p());return{actionState:d("WASyncdConst").SyncActionState.Unsupported}}try{var b=a.indexParts,c=a.value;b=b[1];b||d("WAWebSyncdActionUtils").throwInvalidActionIndex();c=c.noteEditAction;if(!c){d("WALogger").WARN(o());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}if(c.deleted===!0){yield d("WAWebSchemaNote").getNoteTable().remove(b);d("WAWebNoteCollection").NoteCollection.remove(b);return{actionState:d("WASyncdConst").SyncActionState.Success}}var e=c.type,f=c.chatJid,g=c.createdAt;c=c.unstructuredContent;if(e==null){d("WALogger").WARN(n());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}if(f==null){d("WALogger").WARN(m());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}f=d("WAJids").validateChatJid(f);if(f==null){d("WALogger").WARN(l());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}g==null&&d("WALogger").WARN(k());var h=d("WALongInt").maybeNumber(g);g!=null&&h==null&&d("WALogger").WARN(j());c==null&&d("WALogger").WARN(i());e={id:b,type:e===d("WASyncAction.pb").SyncActionValue$NoteEditAction$NoteType.UNSTRUCTURED?"unstructured":"structured",chatJid:f,content:(g=c)!=null?g:"",modifiedAt:a.timestamp,createdAt:Math.floor(((b=h)!=null?b:0)/1e3)};yield d("WAWebNoteAction").upsertFromSyncd(e);return{actionState:d("WASyncdConst").SyncActionState.Success}}catch(a){return{actionState:d("WASyncdConst").SyncActionState.Failed}}});return function(b){return a.apply(this,arguments)}}()))};e.getNoteMutation=function(a){var b={noteEditAction:{type:a.type==="unstructured"?d("WASyncAction.pb").SyncActionValue$NoteEditAction$NoteType.UNSTRUCTURED:d("WASyncAction.pb").SyncActionValue$NoteEditAction$NoteType.STRUCTURED,chatJid:a.chatJid,unstructuredContent:a.content,createdAt:a.createdAt*1e3}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.RegularLow,indexArgs:[d("WAWebBaseModel").idTypeToString(a.id)],value:b,version:this.getVersion(),operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:a.modifiedAt,action:this.getAction()})};return c}(d("WASyncdAction").SyncActionBase);c=new a();g["default"]=c}),98);
__d("WAWebGetOnlyNoteByChatJidJob",["WAJobOrchestratorTypes","WAWebDBNoteDatabaseApi","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.chatJid;return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getOnlyNoteByChatJid",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebDBNoteDatabaseApi").getOnlyNoteByChatJid(c)}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()});return h.apply(this,arguments)}g.getOnlyNoteByChatJidJob=a}),98);
__d("WAWebNotesUtils",["WACryptoSha256","WAWebBizGatingUtils","WAWebFrontendMsgGetters","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WACryptoSha256").sha256Str(a)});return h.apply(this,arguments)}function i(a){return a!=null&&a.isUser()&&!a.isPSA()&&!a.isOfficialBizAccount()&&!a.isIAS()&&!a.isSupportAccount()&&!a.isCAPISupportAccount()&&!a.isBot()&&d("WAWebBizGatingUtils").smbNotesV1Enabled()}function c(a){if(a==null)return!1;var b=d("WAWebFrontendMsgGetters").getText(a);if(b==null||b.trim()==="")return!1;b=d("WAWebFrontendMsgGetters").getChat(a);return b==null?!1:i(b.id)}g.generateNoteId=a;g.shouldEnableNotesForWid=i;g.shouldEnableNotesForMsg=c}),98);
__d("WAWebNoteAction",["invariant","WALogger","WATimeUtils","WAWebBaseModel","WAWebBizGatingUtils","WAWebDBNoteDatabaseApi","WAWebGetOnlyNoteByChatJidJob","WAWebNoteCollection","WAWebNoteModel","WAWebNoteSync","WAWebNotesUtils","WAWebSchemaNote","WAWebSyncd","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Notes] addOrEditNoteAction: id "," mutation generated"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebNoteCollection").NoteCollection.hasCachedQueryForChatJid(a)){var b=(yield d("WAWebGetOnlyNoteByChatJidJob").getOnlyNoteByChatJidJob({chatJid:a}));d("WAWebNoteCollection").NoteCollection.updateCollectionFromDB(a,b)}return d("WAWebNoteCollection").NoteCollection.maybeGetNoteByChatJid(a)});return j.apply(this,arguments)}function e(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){yield o({actionType:"add",noteType:a,chatJid:b,content:c},!0)});return k.apply(this,arguments)}function f(a,b,c,d,e){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){yield o({actionType:"edit",id:a,noteType:b,chatJid:c,content:d,createdAt:e},!0)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield o({actionType:"syncdUpsert",id:d("WAWebBaseModel").idTypeToString(a.id),noteType:a.type,chatJid:a.chatJid,content:a.content,createdAt:a.createdAt,modifiedAt:a.modifiedAt},!1)});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){d("WAWebBizGatingUtils").smbNotesV1Enabled()||h(0,79042);var f=d("WATimeUtils").unixTime(),g=a.id;g==null&&(g=(yield d("WAWebNotesUtils").generateNoteId(a.chatJid)));var j={id:g,type:a.noteType,chatJid:a.chatJid,content:a.content,createdAt:(a=a.createdAt)!=null?a:f,modifiedAt:f};if(e){a=c("WAWebNoteSync").getNoteMutation(j);d("WALogger").LOG(i(),g).devConsole(a);yield d("WAWebSyncd").lockForSync(["note"],[a],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebDBNoteDatabaseApi").addOrEditNote(j)}))}else yield d("WAWebDBNoteDatabaseApi").addOrEditNote(j);d("WAWebNoteCollection").NoteCollection.add(j,{merge:!0})});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("WAWebDBNoteDatabaseApi").getNotesByChatJid(b));c.length>0&&(yield d("WAWebSchemaNote").getNoteTable().bulkRemove(c.map(function(a){return a.id})),d("WAWebNoteCollection").NoteCollection.purgeNotesByChatJid(b));c=(yield d("WAWebDBNoteDatabaseApi").getNotesByChatJid(a));if(c.length===0)return;c=c.map(function(a){return babelHelpers["extends"]({},a,{chatJid:b})});var e=c.map(function(a){return new(d("WAWebNoteModel").Note)(a)});d("WAWebNoteCollection").NoteCollection.purgeNotesByChatJid(a);d("WAWebNoteCollection").NoteCollection.add(e,{merge:!0});return d("WAWebDBNoteDatabaseApi").bulkUpdateNotes(c)});return r.apply(this,arguments)}g.retrieveOnlyNoteForChatJid=a;g.noteAddAction=e;g.noteEditAction=f;g.upsertFromSyncd=m;g.addOrEditNoteAction=o;g.updateNoteJidAction=q}),98);
__d("WAWebFileSaverTypes",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({PNG:".png",TXT:".txt",ZIP:".zip"});f.AllowedFileExtensions=a}),66);/*FB_PKG_DELIM*/
__d("WAWebRichTextInputContentEditable.react",["LexicalComposerContext","WAWebStylesEnv","react","stylex","useWAWebMergeRefs"],(function(a,b,c,d,e,f,g){var h,i,j;b=j||d("react");var k=h||(h=c("react"));e=b.forwardRef;var l=b.useCallback,m=b.useEffect;b=15;var n=1.47,o={contentEditable:{userSelect:"x1hx0egp",overflowX:"x6ikm8r",overflowY:"x1odjw0f",fontSize:"x6prxxf",lineHeight:"x1k6rcq7",$$css:!0},nowrap:{whiteSpace:"x1whj5v",$$css:!0}};e=e(function(a,b){var e,f=a.readOnly,g=f===void 0?!1:f;f=a.spellCheck;var h=a.title,j=a.testid;j=a.tabOrder;var p=a.xstyle,q=a.maxVisibleLines,r=a.minVisibleLines;r=r===void 0?1:r;var s=a.lineWrap;s=s===void 0?!0:s;var t=a.focusOnMount;a=a.onClick;var u=d("LexicalComposerContext").useLexicalComposerContext(),v=u[0];u=l(function(a){v.setRootElement(a),t===!0&&self.setTimeout(function(){return v.focus()},0)},[]);b=c("useWAWebMergeRefs")(b,u);m(function(){v.setEditable(!g)},[v,g]);return k.jsx("div",{className:(i||(i=c("stylex")))(o.contentEditable,p,!s&&o.nowrap),style:{maxHeight:q!=null?n*q+"em":void 0,minHeight:n*r+"em"},contentEditable:!g,role:"textbox",ref:b,spellCheck:f,title:h,"data-testid":void 0,tabIndex:j,"data-tab":j,onClick:a})});var p={container:{position:"x10l6tqk",top:"x13vifvy",bottom:"x1ey2m1c",start:"x1r1tlb4",zIndex:"xhtitgo",color:"x1grh1yo",pointerEvents:"x47corl",userSelect:"x87ps6o",transition:"xh9ts4v",fontSize:"x6prxxf",lineHeight:"x1k6rcq7",$$css:!0},fontSmoothing:{"-webkit-font-smoothing":"xvmahel","-moz-osx-font-smoothing":"xlh3980",$$css:!0}};function a(a){var b=a.testid;b=a.text;a=a.xstyle;return k.jsx("div",{testid:void 0,className:(i||(i=c("stylex")))(p.container,d("WAWebStylesEnv").isOSMac&&p.fontSmoothing,a),children:b})}a.displayName=a.name+" [from "+f.id+"]";g.MIN_FONT_SIZE=b;g.ContentEditable=e;g.Placeholder=a}),98);
__d("useWAWebLexicalEvent",["Lexical","react","useWAWebListener","useWAWebStableCallback"],(function(a,b,c,d,e,f,g){var h,i=(h||d("react")).useEffect;function a(a,b,c,e){d("useWAWebListener").useListener(a&&a.getRootElement(),"keydown",function(d){a&&(b==null||d.key===b)&&c(d,a)},{capture:e})}function b(a,b,e,f){f===void 0&&(f=d("Lexical").COMMAND_PRIORITY_HIGH);var g=c("useWAWebStableCallback")(function(a,b){b=e(a,b);b&&a instanceof KeyboardEvent&&(a.preventDefault(),a.stopPropagation());return b});i(function(){if(!a)return;return a.registerCommand(b,g,f)},[a,b,g,f])}g.useLexicalKeydownEvent=a;g.useLexicalCommandListener=b}),98);
__d("WAWebMentionNode",["$InternalEnum","Lexical","WAWebClassnames","WAWebCopyPasteCopyable.react","WAWebRichTextInputConst","WAWebWidFactory","err"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum").Mirrored(["GROUP","CONTACT"]),i=function(b){babelHelpers.inheritsLoose(a,b);a.clone=function(b){return new a({text:b.__text,name:b.name,wid:b.wid,type:b.type,key:b.__key})};a.getType=function(){return"mention"};a.importJSON=function(){throw c("err")("Deserialization of MentionNode is unsupported")};function a(a){var c=a.text,d=a.name,e=a.wid,f=a.type;a=a.key;c=b.call(this,c,a)||this;c.name=d;c.wid=e;c.type=f;return c}var e=a.prototype;e.createDOM=function(a){a=b.prototype.createDOM.call(this,a);a.className=d("WAWebClassnames").classnamesConvertMeToStylexPlease(a.className,"x1a06ls3");a.dataset[d("WAWebCopyPasteCopyable.react").APP_TEXT_TEMPLATE_DATA_ATTR]=""+d("WAWebRichTextInputConst").ZWS+this.wid+d("WAWebRichTextInputConst").ZWS;return a};e.getNodeMetadata=function(){var a=d("WAWebWidFactory").createWid(this.wid),b=d("WAWebRichTextInputConst").AT_SYMBOL+a.user;this.type===h.GROUP&&(b=d("WAWebRichTextInputConst").AT_SYMBOL+a.toString());return{text:b,parsableText:""+d("WAWebRichTextInputConst").ZWS+this.wid+d("WAWebRichTextInputConst").ZWS,type:this.type,name:this.name,wid:a}};e.exportJSON=function(){throw c("err")("Serialization of MentionNode is unsupported")};return a}(d("Lexical").TextNode);function a(a,b,c){return new i({text:d("WAWebRichTextInputConst").AT_SYMBOL+a,name:a,wid:b,type:c})}function e(a){return a instanceof i}g.MentionTypeEnum=h;g.MentionNode=i;g.$createMentionNode=a;g.$isMentionNode=e}),98);
__d("WAWebEditorRefPlugin",["LexicalComposerContext","react"],(function(a,b,c,d,e,f,g){var h,i=(h||d("react")).useEffect;function a(a){var b=a.editorRef;a=d("LexicalComposerContext").useLexicalComposerContext();var c=a[0];i(function(){typeof b==="function"?b(c):b&&(b.current=c)},[c,b]);return null}g.EditorRefPlugin=a}),98);
__d("WAWebEditorStatePlugin.react",["Lexical","LexicalComposerContext","WAWebMentionNode","react","useWAWebLexicalEvent","useWAWebStableCallback"],(function(a,b,c,d,e,f,g){var h;b=h||d("react");var i=b.useEffect,j=b.useRef;function* k(a){for(a of a.getChildren())yield a,d("Lexical").$isElementNode(a)&&(yield* k(a))}function l(a){var b={text:"",parsableText:"",data:{}};if(!a)return b;var c=[],e=[];a.read(function(){for(var a of d("Lexical").$getRoot().getChildren())if(d("Lexical").$isElementNode(a)){var f="",g="";for(var h of k(a))if(h instanceof d("WAWebMentionNode").MentionNode){var i,j=h.getNodeMetadata();f+=j.text;g+=j.parsableText;b.data.mentionedJidList=(i=b.data.mentionedJidList)!=null?i:[];b.data.groupMentions=(i=b.data.groupMentions)!=null?i:[];i=j.type;var l=j.wid,m=j.name;switch(i){case d("WAWebMentionNode").MentionTypeEnum.CONTACT:b.data.mentionedJidList.push(j.wid);break;case d("WAWebMentionNode").MentionTypeEnum.GROUP:b.data.groupMentions.push({groupJid:l,groupSubject:m});break}}else f+=h.getTextContent(),g+=h.getTextContent();c.push(f);e.push(g)}});b.text=c.join("\n");b.parsableText=e.join("\n");return b}function a(a){var b=a.onBlur,e=a.onChange,f=a.onFocus;a=d("LexicalComposerContext").useLexicalComposerContext();var g=a[0],h=j(),k=c("useWAWebStableCallback")(function(a,b){e&&e(l(a),a,b)});i(function(){if(g){var a=g.getEditorState().read(function(){return d("Lexical").$getRoot().getTextContent()});h.current=a;k(g.getEditorState(),!0)}},[g,k]);i(function(){if(!g)return;return g.registerUpdateListener(function(a){a=a.editorState;if(g.isComposing())return;var b=a.read(function(){return d("Lexical").$getRoot().getTextContent()});if(h.current===b)return;h.current=b;k(a,!1)})},[g,k]);d("useWAWebLexicalEvent").useLexicalCommandListener(g,d("Lexical").BLUR_COMMAND,function(a){b==null?void 0:b(a);return!1});d("useWAWebLexicalEvent").useLexicalCommandListener(g,d("Lexical").FOCUS_COMMAND,function(a){f==null?void 0:f(a);return!1});return null}g.EditorStatePlugin=a}),98);
__d("WAWebMultilinePlugin",["Lexical","LexicalComposerContext","WAWebLexicalUtils","useWAWebLexicalEvent"],(function(a,b,c,d,e,f,g){var h=d("Lexical").createCommand();function a(a){var b=a.multiline;a=d("LexicalComposerContext").useLexicalComposerContext();var c=a[0];a=function(){b&&c.update(function(){var a;(a=d("WAWebLexicalUtils").$getRangeSelection())==null?void 0:a.insertParagraph();c.dispatchCommand(h)});return!0};d("useWAWebLexicalEvent").useLexicalCommandListener(c,d("Lexical").INSERT_LINE_BREAK_COMMAND,a);d("useWAWebLexicalEvent").useLexicalCommandListener(c,d("Lexical").INSERT_PARAGRAPH_COMMAND,a);return null}g.NEW_PARAGRAPH_COMMAND=h;g.MultilinePlugin=a}),98);
__d("WAWebOnKeyDownPlugin",["LexicalComposerContext","useWAWebLexicalEvent"],(function(a,b,c,d,e,f,g){function a(a){var b=a.onKeyDown;a=d("LexicalComposerContext").useLexicalComposerContext();a=a[0];d("useWAWebLexicalEvent").useLexicalKeydownEvent(a,null,function(a){b==null?void 0:b(a)});return null}g.OnKeyDownPlugin=a}),98);/*FB_PKG_DELIM*/
__d("WAWebNotificationsCallNotification",["WAWebBaseNotification","WAWebChatFlowTypes","WAWebContactCollection","WAWebFrontendContactGetters","WAWebMuteCollection","WAWebMuteGetters","WAWebNotificationController","WAWebNotificationIconUtils","WAWebWid","WAWebWidFormat","asyncToGeneratorRuntime","fbs"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebNotificationController").WANotificationController.triggerNotification(new h(a))}function e(a){a&&d("WAWebNotificationController").WANotificationController.closeOrCancelNotification(a.toString())}var h=function(e){babelHelpers.inheritsLoose(a,e);function a(a){var b,c=a.wid,d=a.msgId,f=a.isVideo,g=a.isGroup;a=a.isSilenced;b=e.call(this)||this;b.wid=c;b.msgId=d;b.isVideo=f;b.isGroup=g;b.isSilenced=a;return b}var f=a.prototype;f.shouldMute=function(){return!this.wid||!this.msgId||d("WAWebMuteGetters").getIsMuted(d("WAWebMuteCollection").MuteCollection.globalMute())||this.isSilenced?!0:!1};f.buildKey=function(){return"call:"+this.wid.toString()};f.matchesChat=function(a){return c("WAWebWid").equals(this.wid,a)};f.getChatKind=function(){return this.isGroup?d("WAWebChatFlowTypes").ChatKindType.Group:d("WAWebChatFlowTypes").ChatKindType.Chat};f.getIcon=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebNotificationIconUtils").getNotificationIconByWid(this.wid,this.abortController.signal,d("WAWebNotificationIconUtils").USER_DEFAULT_ICON)});function c(){return a.apply(this,arguments)}return c}();f.getBannerOptions=function(){var a=d("WAWebContactCollection").ContactCollection.get(this.wid);a=a?d("WAWebFrontendContactGetters").getFormattedName(a):d("WAWebWidFormat").widToFormattedUser(this.wid);var b;this.isGroup?b=this.isVideo?c("fbs")._("__JHASH__RQBTNX-HdiW__JHASH__",[c("fbs")._param("name",a)]).toString():c("fbs")._("__JHASH__Zk7d2XrvIhj__JHASH__",[c("fbs")._param("name",a)]).toString():b=this.isVideo?c("fbs")._("__JHASH__RzRngOjqL6i__JHASH__",[c("fbs")._param("name",a)]).toString():c("fbs")._("__JHASH__hm66-RoBY0V__JHASH__",[c("fbs")._param("name",a)]).toString();a=c("fbs")._("__JHASH__kAWDCkdZsPY__JHASH__").toString();return{wid:this.wid,msgId:this.msgId,tag:this.msgId,title:b,body:a}};return a}(d("WAWebBaseNotification").WABaseNotification);g.showCallNotification=a;g.cancelCallNotification=e;g.WACallNotification=h}),226);/*FB_PKG_DELIM*/
/**
 * License: https://www.facebook.com/legal/license/V8_l6oUwABQ/
 */
__d("react-dom-0.0.0",["ReactDOM"],(function(a,b,c,d,e,f){"use strict";function a(a){return a&&typeof a==="object"&&"default"in a?a["default"]:a}var g=a(b("ReactDOM"));d={};var h={exports:d};function i(){h.exports=g}var j=!1;function k(){j||(j=!0,i());return h.exports}function c(a){switch(a){case void 0:return k()}}e.exports=c}),null);/*FB_PKG_DELIM*/
__d("react-dom",["react-dom-0.0.0"],(function(a,b,c,d,e,f){e.exports=b("react-dom-0.0.0")()}),null);